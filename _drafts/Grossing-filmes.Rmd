

# Motivation 
I finally could make to the movies for watching George Luca's Star Wars. Although this release wasn't that expetacular, in my view, it did inspire a little data work afterwards to explore how this film compares to others in terms of grossing. 

Fortunately, there is a wealth--though incomplete--list of the top grossing films of all time at <boxofficemojo.com>. 
The information is hight there in the main page, but I was looking for something more visual tasting. So, I decide to use *R* to grab the data and construct a plot with the new released *ggplot2*.

# Motivation 
Find out the top grossing films of all time
I was looking at a list of the top grossing films of all time (available from boxofficemojo.com) and was wondering what kind of graphs I would come up with if I had that kind of data. I still don’t know what kind of graphs I’d construct other than a simple barplot but figured I’d at least get the basics done and then if I feel motivated enough I could revisit this in the future.

Objective


Scrape the information available on http://boxofficemojo.com/alltime/world into R and make a simple barplot.

Solution

This is probably one of the easier scraping challenges. The function readHTMLTable() from the XML package does all the hard work. We just point the url of the page we’re interested in and feed it into the function. The function then pulls out all tables on the webpage as a list of data.frames. We then choose which data.frame we want. Here’s a single wrapper function:

The required libraries for this task are the following.
```{r}
library(XML)
library(ggplot2)
# library(SciencesPo) if you want to use the same plot theme I've used: 
```

```{r}
BoxOfficeMojoScraper <- function(num.pages) {
    get_table <- function(t) {
      table <- readHTMLTable(t)[[3]]
      names(table) <- c("Rank", "Title", "Studio", "Worldwide.Gross", "Domestic.Gross", "Domestic.pct", "Overseas.Gross", "Overseas.pct", "Year")
      df <- transform(df, Year = ifelse(Year==0, NA, Year))
      df <- as.data.frame(lapply(table[-1, ], as.character), stringsAsFactors=FALSE)
      df <- as.data.frame(df, stringsAsFactors=FALSE)
      return(df)
    }
    # A little cleaning here
    clean_df <- function(df) {
      clean <- function(col) {
        col <- gsub("$", "", col, fixed = TRUE)
        col <- gsub("%", "", col, fixed = TRUE)
        col <- gsub(",", "", col, fixed = TRUE)
        col <- gsub("^", "", col, fixed = TRUE)
        return(col)
      }
      df <- sapply(df, clean)
      df <- as.data.frame(df, stringsAsFactors=FALSE)
      return(df)
    }
    # Step 1: construct URLs
urls <- paste("http://boxofficemojo.com/alltime/world/?pagenum=", 1:num.pages, "&p=.htm", sep = "")
    # Step 2: scrape website
    df <- do.call("rbind", lapply(urls, get_table))
    # Step 3: clean dataframe
    df <- clean_df(df)
    # Step 4: set column types
    s <- c(1, 4:9)
    df[, s] <- sapply(df[, s], as.numeric)
    df$Studio <- as.factor(df$Studio)
    # step 5: return dataframe
    return(df)
  }
```


Here we're scrapping the first 7 pages of our target address <http://www.boxofficemojo.com/alltime/world/>. In this process we will receive missing values too, don't worry, for the time being.

```{r}
num.pages <- 7
df <- BoxOfficeMojoScraper(num.pages)
```

```{r}
head(df)
```

```{r}
str(df)
```
Our new acquired data has films as old as 
min(df$Year, na.rm=TRUE)

df2 <- subset(df, Rank<=25)
ggplot(df2, aes(x=reorder(Title, Worldwide.Gross), y=Worldwide.Gross)) +
  geom_bar(stat = "identity") +
  coord_flip() + theme_grey() +
  ggtitle("Top 25 Films by Worldwide Gross (US$ Millions)")
```
