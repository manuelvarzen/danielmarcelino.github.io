---
title: "Simulation of Random Allocation in R"
author: "Daniel Marcelino"
date: "January 3, 2016"
output: html_document
---



The purpose of this simulation is used to confirm whether the approaching overall average value After allocating How many people in a group empirically.

It has nothing to do with the class because a thing it was a hobby. No need to remember R. May you not understand. If you've never touched an R, it is good without reading it because I think I do not know what you're doing.

So, immediately

Calling ggplot2 package for drawing. If, ggplot2 is I should be installed if not on the R, first with install.packages ("ggplot2").

```{r setup, include=FALSE}
library(ggplot2)
```


Then we want to set the number of experimental group n.group. Here, the control group, is set in the experimental group 1, 3 in the fact that the experimental group 2

```{r setup, include=FALSE}
n.group <- 3
```

Subsequently, the creation of the data frame to store the simulation result.

```{r setup, include=FALSE}
result.df <- data.frame(n           = rep(NA, 996),
                        sex.mean    = rep(NA, 996),
                        age.mean    = rep(NA, 996),
                        trust.mean  = rep(NA, 996),
                        n1          = rep(NA, 996),
                        n2          = rep(NA, 996),
                        n3          = rep(NA, 996),
                        sex.mean1   = rep(NA, 996),
                        sex.mean2   = rep(NA, 996),
                        sex.mean3   = rep(NA, 996),
                        age.mean1   = rep(NA, 996),
                        age.mean2   = rep(NA, 996),
                        age.mean3   = rep(NA, 996),
                        trust.mean1 = rep(NA, 996),
                        trust.mean2 = rep(NA, 996),
                        trust.mean3 = rep(NA, 996))
```


I try to write a full-fledged simulation code. To to enter from theoretically 5 to 1000 in one of the experimental group. In other words, the sample size will increase by 3 15-3000.

```{r setup, include=FALSE}
for (i in 5:1000){
  # To generate fictitious data set
  # x belong roughly to each of the groups
  # Three times the sample size of x
  sex   <- sample(0:1,   i * n.group, replace = TRUE)
  age   <- sample(20:70, i * n.group, replace = TRUE)
  trust <- sample(1:5,   i * n.group, replace = TRUE)

#--------------------------------
# Divide the group
#--------------------------------
  group.id <- sample(1:n.group, i * n.group, replace = TRUE)
#---------------------------------
# Save data as a data.frame
#---------------------------------
  temp.df <- data.frame(sex, age, trust, group.id)

#---------------------------------
# Sample size
#---------------------------------
  sample.size <- i * n.group
  
#---------------------------------
# The average of the entire sample by sex, age, and trust
#---------------------------------
  sex.mean   <- mean(temp.df$sex  )
  age.mean   <- mean(temp.df$age  )
  trust.mean <- mean(temp.df$trust)

#---------------------------------
#  And calculate if it were belong many cases for each group
# The average of the entire sample by sex, age, and trust
#---------------------------------
  n1 <- nrow(subset(temp.df, group.id == 1))
  n2 <- nrow(subset(temp.df, group.id == 2))
  n3 <- nrow(subset(temp.df, group.id == 3))

#---------------------------------
# Calculate the mean values for sex age and trust of each group
#---------------------------------
  sex.mean1 ã€€<- mean(subset(temp.df, group.id == 1)$sex  )
  sex.mean2   <- mean(subset(temp.df, group.id == 2)$sex  )
  sex.mean3   <- mean(subset(temp.df, group.id == 3)$sex  )
  age.mean1   <- mean(subset(temp.df, group.id == 1)$age  )
  age.mean2   <- mean(subset(temp.df, group.id == 2)$age  )
  age.mean3   <- mean(subset(temp.df, group.id == 3)$age  )
  trust.mean1 <- mean(subset(temp.df, group.id == 1)$trust)
  trust.mean2 <- mean(subset(temp.df, group.id == 2)$trust)
  trust.mean3 <- mean(subset(temp.df, group.id == 3)$trust)

#---------------------------------
# Save the results 
#---------------------------------
  result.df[i-4, ] <- c(sample.size, sex.mean, age.mean, trust.mean,
                        n1, n2, n3,
                        sex.mean1, sex.mean2, sex.mean3,
                        age.mean1, age.mean2, age.mean3,
                        trust.mean1, trust.mean2, trust.mean3)
}
```


## We try to see the results in a graph.


First of all, we see what has been allocated one chants three minutes to each group. Solid red to represent one-third, that is close to the solid line means that it is ideally assigned.



```{r setup, include=FALSE}
# Check whether the entered 1/3 properly in each group.
# What can be described as being distributed in the ideal proportions closer to the solid line in red

ggplot(data = result.df) +
  geom_line(aes(x = n, y = n1/n, color = "red"),   alpha = 0.4) +
  geom_line(aes(x = n, y = n2/n, color = "blue"),  alpha = 0.4) +
  geom_line(aes(x = n, y = n3/n, color = "green"), alpha = 0.4) +
  geom_hline(yintercept = 1/3, color = "red") +
  geom_vline(xintercept = 750, color = "red") +
  scale_color_discrete(name = "Group",
                       labels = c("Group1", "Group3", "Group2")) +
  labs(x = "Sample size", y = "Sample size in each group") +
  theme(legend.position = "bottom")
```


Roughly three groups the sample size is about 500-750 is generally possible to confirm that the allocated one third.

Next, the average value of the assigned group sex we see a uniform whether or not. Average sex three three groups the line is gathered, with the exception of purple generally means that together. So be careful red solid line represents a is a theoretical value of 0.5, the first place guarantee that the average of the sample is in 0.5 is not.

```{r setup, include=FALSE}
# Sex of each group, age, the average value of the trust.
# Purple The overall average value
# Red solid line is the theoretical value

ggplot(data = result.df) +
  geom_line(aes(x = n, y = sex.mean,  color = "black"), alpha = 0.4) +
  geom_line(aes(x = n, y = sex.mean1, color = "red"),   alpha = 0.4) +
  geom_line(aes(x = n, y = sex.mean2, color = "blue"),  alpha = 0.4) +
  geom_line(aes(x = n, y = sex.mean3, color = "green"), alpha = 0.4) +
  geom_hline(yintercept = 0.5, color = "red") +
  geom_vline(xintercept = 750, color = "red") +
  scale_color_discrete(name = "Group",
                       labels = c("Group1", "Group3", "Group2", "Entire")) +
  labs(x = "Sample size", y = "Mean of Sex") +
  theme(legend.position = "bottom")
```



When the sample size increases three lines except the purple confirmed that go together to the red solid lines. However, the sample size is large difference in 15 people when changes from (minimum value) 600 and 1000 clearly the former is looking at the difference at the time of change in 3000. That is, in the three groups, 0/1 variable sample size is approximately 500 in the case of homogeneity between groups when words are about 170 people in a group are guaranteed, it is not dramatically increase the sample size from there as long as, big change it not believed.

Also Let's look at age and trust in the same procedure.

```{r setup, include=FALSE}
ggplot(data = result.df) +
  geom_line(aes(x = n, y = age.mean,  color = "black"), alpha = 0.4) +
  geom_line(aes(x = n, y = age.mean1, color = "red"),   alpha = 0.4) +
  geom_line(aes(x = n, y = age.mean2, color = "blue"),  alpha = 0.4) +
  geom_line(aes(x = n, y = age.mean3, color = "green"), alpha = 0.4) +
  geom_hline(yintercept = 45, color = "red") +
  geom_vline(xintercept = 750, color = "red") +
  scale_color_discrete(name = "Group",
                       labels = c("Group1", "Group3", "Group2", "Entire")) +
  labs(x = "Sample size", y = "Mean of Age") +
  theme(legend.position = "bottom")
  
```




```{r setup, include=FALSE}

ggplot(data = result.df) +
  geom_line(aes(x = n, y = trust.mean,  color = "black"), alpha = 0.4) +
  geom_line(aes(x = n, y = trust.mean1, color = "red"),   alpha = 0.4) +
  geom_line(aes(x = n, y = trust.mean2, color = "blue"),  alpha = 0.4) +
  geom_line(aes(x = n, y = trust.mean3, color = "green"), alpha = 0.4) +
  geom_hline(yintercept = 3, color = "red") +
  geom_vline(xintercept = 750, color = "red") +
  scale_color_discrete(name = "Group",
                       labels = c("Group1", "Group3", "Group2", "Entire")) +
  labs(x = "Sample size", y = "Mean of Trust") +
  theme(legend.position = "bottom")
```


Consequently see the (here group is about 750 because three) sample size to be allocated about 250 people in a group with, it can be confirmed that the sample size and the expected value for each variable in each group to a certain extent stable.

Maybe, the scale of measurement question (ie, variance) and there may be a relationship. Binomial variable (sex) and categorical variables (trust) is certainly N = 500, in other words it appears to be stable at about 166 people in each group, continuous variables (age) is I think about 250 people. I think also if not due to the width of the maximum value of the minimum value of the scale is large and the dispersion is increased. It may be worth a simulation while messing around with dispersion measures in this regard.
