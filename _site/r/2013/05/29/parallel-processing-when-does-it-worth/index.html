<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
  <head>
		
<title>&middot; Daniel &middot; Parallel Processing: When does it worth?</title>
        <!-- favicon -->
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />

        <meta charset="utf-8" />
    <meta content='text/html; charset=utf-8' http-equiv='Content-Type'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge' chrome=1>
	<meta name="google-site-verification" content="Vk0IOJ2jwG_qEoG7fuEXYqv0m2rLa8P778Fi_GrsgEQ" />
	<meta name="bing_webmastertools_id" content="97837256955BD270FD688E2B50F89FDB" />
    <meta name="description" content="Code and data"/>
    <meta name="viewport" content="width=device-width">
    <meta name="author" content="Daniel Marcelino"/>
    <meta name="viewport" content="width=640px, initial-scale=1.0, maximum-scale=1.5">	
    <meta name="keywords" content="Daniel Marcelino, SciencesPo, SoundexBr, r-project, r-cran, r, statistics, methods, programming, data mining, data visualization, datascience, data"/>	
    
    <meta name="description" content="Parallel computing is incredibly useful, but not every thing worths distribute across as many cores as possible.
" />
    <meta property="og:description" content="Parallel computing is incredibly useful, but not every thing worths distribute across as many cores as possible.
" />
    
    <meta name="author" content="EnfoRced Data Analysis" />
    
    <meta property="og:title" content="Parallel Processing: When does it worth?" />
    <meta property="twitter:title" content="Parallel Processing: When does it worth?" />
    

    <!--[if lt IE 9]>
      <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

	<link rel="stylesheet" type="text/css" href="/style.css" />
    <link rel="alternate" type="application/atom+xml" title="EnfoRced Data Analysis - Blog of Daniel Marcelino" href="/atom.xml" />
	 <link rel="alternate" type="application/rss+xml" title="EnfoRced Data Analysis - Blog of Daniel Marcelino" href="/feed.xml" />
    <link rel="alternate" type="application/rss+xml" title="EnfoRced Data Analysis - Blog of Daniel Marcelino" href="/feed.r.xml" />
	
        <!-- Google Fonts -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,300,400,600" rel="stylesheet" type="text/css">
		<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
        <!-- Custom CSS -->
		  <!-- Jquery & D3js -->
	   <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	   <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
		
		
    <!-- Created with Jekyll Now - http://github.com/barryclark/jekyll-now -->
  </head>

  <body>
    <div class="wrapper-masthead">
      <div class="container">
        <header class="masthead clearfix">
          <a href="/" class="site-avatar"><img src="https://41.media.tumblr.com/05546119a35e7acb34a47344bc7de012/tumblr_nypg9aPsBy1v0aqj1o1_500.jpg" /></a>

          <div class="site-info">
            <h1 class="site-name"><a href="/">EnfoRced Data Analysis</a></h1>
            <p class="site-description">Blog of Daniel Marcelino</p>
          </div>

          <nav>
            <a href="/">Blog</a>
            <a href="/about">About</a>
			<a href="/research">Research</a>
			<a href="/randomwalks">Random Walks</a>
          </nav>
        </header>
      </div>
    </div>

    <div id="main" role="main" class="container">
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$', '$'], ["\(", "\)"] ],
        displayMath: [ ['$$', '$$'], ["\[", "\]"] ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
      //,
      //displayAlign: "left",
      //displayIndent: "2em"
    });
</script>
<script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML" type="text/javascript"></script>


	
<article class="post">
  <h1>Parallel Processing: When does it worth?</h1>

  <div class="entry">
    <p>Parallel computing is incredibly useful, but not every thing worths distribute across as many cores as possible.</p>

<!--more-->

<p><img src="http://danielmarcelino.github.io/img/2013/parallel.jpg" alt="Experiment Result"></p>

<p>Most computers nowadays have few cores that incredibly help us with our daily computing duties. However, when statistical softwares do use parallelization for analyzing data faster? R, my preferred analytical package, does not take too much advantage of multicore processing by default. </p>

<p>In fact, R has been inherently a &quot;single-processor&quot; package until nowadays. Stata, another decent statistical package, allows for multicore processing, but not yet implemented for the default version. Additionally, Stata versions for multicore are quite expensive, for instance, if I want to use all of my quad-core computer power, I have to pay out $1,095 for a 4-core single license.</p>

<p>Fortunately, several packages exploiting the resources of parallel processing began to gain attention in the R community lately. Specially, because of many computationally demanding statistical procedures, such as bootstrapping and Markov Chain Monte Carlo, I guess. Nonetheless, the myth of fast computation has also leading for (miss)understanding by ordinary R users like me. Yet before distributing patches among CPUs, it is important to have it clear when and why parallel processing is helpful and which functions performs better for a given job.</p>

<p>First, what does exactly parallel do? Despite its complex implementation, the idea is incredible simple: parallelization simply distribute the work among two or more cores. It is done by packages that provide backend for the “foreach” function to work. The foreach function allows R to distribute the processes, each of which having access to the same shared memory; so the computer not get confused. For instance, in the program bellow, several instances of lapply-like function are able to access the processing units and then deal out with all the work.</p>

<p>Since not every task runs better in parallel there is not too many ready to use parallel processing functions in R. Additionally, distributing processes among the cores may cause computation overhead. That means we may lose computer time and memory, firstly by distributing, secondly by gathering the patches shared out among the processing units. Therefore, depending on the task (time and memory demand), parallel computing can be rather inefficient. It may take more time for dispatching the processes and gathering them back than the computation itself. Hence, counterintuitively, one might want to minimize the number of dispatches rather than distribute them.</p>

<p>Here, I&#39;m testing a nontrivial computation instance for measuring computer performance on four relevant functions: the base <strong>lapply</strong>, <strong>mclapply</strong> from the “multicore“ package, <strong>parLapply</strong> from “snow” package, and <strong>sfLapply</strong> from “snowfall“ package. The last three functions essentially provide parallelized equivalent for the <code>lapply</code>. I use these packages for parallel computing the average for each column of a data frame built on the fly, but repeating this procedure 100 times for each data frame trial; so each trial demands different amount of time and memory for computing: the matrix size increases as 1K, 10K, 100K, 1M, and 10M rows. The program I used for simulate the data and perform all the tests can be found <a href="https://gist.github.com/danielmarcelino/5668701">here</a>. I used Emacs on a MacBook pro with 4-core and 8-G memory.</p>

<p><img src="http://danielmarcelino.github.io/img/2013/parallelfinal.jpeg" alt="Final Results"></p>

<p>My initial experiment also included the &quot;mpi.parLapply&quot; function from the &quot;Rmpi&quot; package. However, because it is outdated for running on R version 3.0, I decided for not including it in this instance.</p>

<p>Overall, running repetition tasks in parallel incurs overhead. Therefore, only if the process takes a significant amount of time and memory (RAM), parallelization can improve the overall performance. </p>

<p>The plots above, provide evidence when an individual process takes less than a second (<code>2.650/100 = 26.5 milliseconds</code> comparable to <code>13.419/100 = 134.2 milliseconds</code>) to be executed, the overhead of continually patching processes will decay the overall performance. For instance, in the first chart, the lapply function took less than one-third of the time of <strong>sfLapply</strong> to perform the same job. However, the pattern changes dramatically when the computer needs to repeat the same task with large vectors (&gt;= 1 million rows). </p>

<p>In fact, I noticed that all functions began to consume even more time computing  averages of big matrixes than I expected. But in a setting with 10 millions rows, the <strong>lapply</strong> function was dramatically inefficient: it took <code>1281.8/100 = 12.82 seconds</code> for each process, while the <strong>mclapply</strong> only took <code>525.4/100 = 5.254 seconds</code>.</p>

  </div>

  <div class="date">
    Written on May 29, 2013
  </div>

  
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">

	    var disqus_shortname = 'daniel-marcelino';

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();

	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>

</article>


    </div>

    <div class="wrapper-footer">
      <div class="container">
        <footer class="footer">
           <footer>
      <div class="row">
          <div class="col-md-4 text-left">
            Daniel Marcelino 2015 <span class="fa fa-creative-commons"></span>
          </div>
           <div class="col-md-4 text-center">
            <span class="fa fa-pencil"></span> with <span class="red pulse fa fa-heart"></span> &
            <span class="fa fa-coffee"></span>.
              <span class="fa fa-code"></span> in <span class="fa fa-github-alt"></span>
            </a>
          </div>
        <div class="col-md-4 text-right">
          <a
            href ="https://twitter.com/dmarcelinobr"
            title="My twitter account">
              <span class="thunder fa fa-twitter"></span>
          </a>
          <a
            href ="https://facebook.com/dmarcelinobr"
            title="My facebook account">
              <span class="thunder fa fa-facebook-official"></span>
          </a>
          <a
            href ="https://cl.linkedin.com/in/daniel-marcelino-80968656"
            title="My linkedin profile">
              <span class="thunder fa fa-linkedin"></span>
          </a>
          <a
            href ="https://plus.google.com/+dmsilva.br/posts"
            title="My google profile">
              <span class="thunder fa fa-google-plus"></span>
          </a>
          <a
            href ="https://github.com/danielmarcelino/"
            title="My github repos!">
              <span class="thunder fa fa-github"></span>
          </a>
          <a
            href ="https://github.com/danielmarcelino/"
            title="My github repos!">
              <span class="thunder fa fa-rss"></span>
          </a>
        </div>
        
      </div>
	 
  </footer>
        </footer>
      </div>
    </div>

    
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-24186657-1', 'auto');
		ga('send', 'pageview', {
		  'page': '/r/2013/05/29/parallel-processing-when-does-it-worth/',
		  'title': 'Parallel Processing: When does it worth?'
		});
	</script>
	<!-- End Google Analytics -->


  </body>
</html>
