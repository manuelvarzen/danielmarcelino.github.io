<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
<link rel="hub" href="https://pubsubhubbub.appspot.com"/>

  <title type="text" xml:lang="en"></title>
    <link type="application/atom+xml" href="/atom.xml" rel="self"/>
    <link href="/"/>
  <updated>2016-05-17T20:08:15Z</updated>
  <id>/</id>
  <author>
    <name></name>
    <email></email>
  </author>
  <rights type="text">Copyright © 2016 . All rights reserved.</rights>
  
  <entry>
    <title>Everything Ends on Wednesday</title>
    <link rel="alternate" type="text/html" href="/blog/2016/Everything-Ends-on-Wednesday.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=EverythingEndsonWednesday" />
    <published>2016-02-12T00:00:00Z</published>
    <updated>2016-02-12T00:00:00-02:00</updated>
    <id>/blog/2016/Everything-Ends-on-Wednesday</id>
    <content type="html"><![CDATA[ <p>The Brazilian Carnival just ended this week, but for some people it is time to starting worry about crazy things that may have happened over the days of the flesh festival.</p>

<p>Watching the news, the spokesperson of the Test and Prevention Center (CTA) in Brasilia estimated that the number of people seeking counseling and test kits increases on average 40% the day after the carnival (Wednesday). He also disclosed that 2 out of 124 performed tests (most likely staff finger stick tests) turned out positive.</p>

<p>After the news I started thinking of HIV incidence among Brazilians and how likely it is to be tested positive when incidence levels also change; every year these numbers go up and dow accordingly to the government policies.</p>

<p>After a little research, I found several sources with estimated quantities of the incidence of HIV/AIDS. The one I chose, says for instance, in 2011 the incidence rate of AIDS (stage when the disease manifests itself in the patient) in Brazil was 17.9 to 100,000 inhabitants. This number varies  significantly across the regions, so it’s higher in South-East and lower in the Midwest of the country, with others regions falling in between. The incidence rate also varies between males and females, and among age groups. For the sake of simplicity, I will not consider those differences here. It would get too complicated for a blog post post-carnival.</p>

<p>Consider that the <a href="https://en.wikipedia.org/wiki/ELISA">enzyme-linked immunosorbent assay (ELISA screening test)</a> for testing a blood sample for the HIV antibodies being present in human blood has the following properties:</p>

<p>Sensitivity:</p>

<script type="math/tex; mode=display">P(positive~ELISA~|~person~is~HIV~positive) = .977</script>

<p>Specificity:</p>

<script type="math/tex; mode=display">P(negative~ELISA~|~person~is~HIV~negative) = .926</script>

<p><strong>Sensitivity</strong> is the percentage of individuals with HIV infection (based on ELISA reading) whom  correctly identified as having infection (aka the true positive rate). <strong>Specificity</strong> is the percentage of individuals without HIV infection (based on ELISA reading) whom correctly identified as being free of infection (aka true negative rate). No test is perfect, as a consequence, few individuals will receive false negatives and others false positives.</p>

<p>Suppose the incidence of HIV in the population being tested is denoted by p . Replacing: <em>p = 18/100000</em> or <em>0.00018</em>. Using the Law of Total Probability we can show this relation as:</p>

<script type="math/tex; mode=display">P(HIV~positive~|~positive~ELISA) = p * .977~/~(p * .977 + (1-p) * .074)</script>

<p>Here is the output and R code  computing this for various values of p with a 25 interval.</p>

<p><img src="http://danielmarcelino.github.io/img/2016/Sensitivity.png" alt="center" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">cases</span> <span class="o">&lt;-</span> <span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">10000</span><span class="p">,</span> <span class="m">25</span><span class="p">)</span>

<span class="n">p</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="n">cases</span><span class="o">/</span><span class="m">100000</span><span class="p">)</span>
<span class="n">prob</span> <span class="o">&lt;-</span> <span class="n">p</span><span class="o">*</span><span class="m">.977</span> <span class="o">/</span> <span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="m">.977</span> <span class="o">+</span> <span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">p</span><span class="p">)</span><span class="o">*</span><span class="m">.074</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&gt;</span> <span class="n">head</span><span class="p">(</span><span class="n">round</span><span class="p">(</span><span class="n">cbind</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">prob</span><span class="p">),</span><span class="m">3</span><span class="p">),</span> <span class="m">10</span><span class="p">)</span>
          <span class="n">p</span>  <span class="n">prob</span>
 <span class="p">[</span><span class="m">1</span><span class="p">,]</span> <span class="m">0.000</span> <span class="m">0.000</span>
 <span class="p">[</span><span class="m">2</span><span class="p">,]</span> <span class="m">0.000</span> <span class="m">0.003</span>
 <span class="p">[</span><span class="m">3</span><span class="p">,]</span> <span class="m">0.000</span> <span class="m">0.007</span>
 <span class="p">[</span><span class="m">4</span><span class="p">,]</span> <span class="m">0.001</span> <span class="m">0.010</span>
 <span class="p">[</span><span class="m">5</span><span class="p">,]</span> <span class="m">0.001</span> <span class="m">0.013</span>
 <span class="p">[</span><span class="m">6</span><span class="p">,]</span> <span class="m">0.001</span> <span class="m">0.016</span>
 <span class="p">[</span><span class="m">7</span><span class="p">,]</span> <span class="m">0.002</span> <span class="m">0.019</span>
 <span class="p">[</span><span class="m">8</span><span class="p">,]</span> <span class="m">0.002</span> <span class="m">0.023</span>
 <span class="p">[</span><span class="m">9</span><span class="p">,]</span> <span class="m">0.002</span> <span class="m">0.026</span>
<span class="p">[</span><span class="m">10</span><span class="p">,]</span> <span class="m">0.002</span> <span class="m">0.029</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"> <span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
 <span class="n">library</span><span class="p">(</span><span class="n">SciencesPo</span><span class="p">)</span> <span class="c1"># for using theme_538
</span><span class="n">ggplot</span><span class="p">()</span> <span class="o">+</span> 
<span class="n">geom_line</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">p</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">theme_538</span><span class="p">()</span>

 </code></pre></figure>

<p>I’m not in the field of epidemiology or biostatistics, but this simple experiment teaches two things. First, it is really important to keep the incidence rate low. Assuming we randomly selected you for the test, when <em>p</em> is really small, it’s much more likely that you got a false positive (you are positive when you are in fact negative). But as <em>p</em> gets larger, it becomes more likely that you do have the infection and the test result is accurate. Second, the accuracy of the test “improves” as a by-product of the incidence/prevalence among elements within the population.</p>
 ]]></content>
  </entry>
  
  <entry>
    <title>The Star Wars Grossing War</title>
    <link rel="alternate" type="text/html" href="/blog/2016/star-wars-grossing-war.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=TheStarWarsGrossingWar" />
    <published>2016-01-11T00:00:00Z</published>
    <updated>2016-01-11T00:00:00-02:00</updated>
    <id>/blog/2016/star-wars-grossing-war</id>
    <content type="html"><![CDATA[ <h1 id="motivation">Motivation</h1>
<p>I finally made to the movies for watching the new <em>Star Wars</em> release this weekend. Although this episode wasn’t that spectacular, in my view, it did inspire some data seeking afterwards. I wanted to know how this film compares to others top movies in terms of worldwide grossing as well as within the <em>Star Wars</em> series.</p>

<p>Fortunately, there is a wealth–though incomplete–list of the top grossing films of all time at <boxofficemojo.com>. Although the information is right in the front-page, I'd rather like something more visual teasing. So, I decided to see how it goes with *R* and the new  *ggplot2* package release. Also, because I must scrap the data from the *Box Office* website, I will need a function to handle the HTML structure of those tables. The function `readHTMLTable()` from the *XML* package can certainly be an asset here.</boxofficemojo.com></p>

<h1 id="the-setup">The setup</h1>
<p>First, let’s load the packages we’ll need.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">XML</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span></code></pre></figure>

<p>In what follows is my setup for using the <code class="highlighter-rouge">readHTMLTable</code> function to retrieve, cleaning, and arrange HTML tables in a data.frame format. I’d rather wrap everything in a single function, but keeping the three snippets apart is rather easy to make out.</p>

<p>The first function will pull out all tables on the webpage as a list of data.frames, and I’ll give them similar names.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">GetTable</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="p">{</span>
<span class="n">table</span> <span class="o">&lt;-</span> <span class="n">readHTMLTable</span><span class="p">(</span><span class="n">t</span><span class="p">)[[</span><span class="m">2</span><span class="p">]]</span>
<span class="n">names</span><span class="p">(</span><span class="n">table</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Rank"</span><span class="p">,</span> <span class="s2">"Title"</span><span class="p">,</span> <span class="s2">"Studio"</span><span class="p">,</span> <span class="s2">"Worldwide"</span><span class="p">,</span> <span class="s2">"Domestic"</span><span class="p">,</span> <span class="s2">"DomesticPct"</span><span class="p">,</span> <span class="s2">"Overseas"</span><span class="p">,</span> <span class="s2">"OverseasPct"</span><span class="p">,</span> <span class="s2">"Year"</span><span class="p">)</span>
<span class="n">boxdf</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">lapply</span><span class="p">(</span><span class="n">table</span><span class="p">[</span><span class="m">-1</span><span class="p">,</span> <span class="p">],</span> <span class="n">as.character</span><span class="p">),</span> <span class="n">stringsAsFactors</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">boxdf</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">boxdf</span><span class="p">,</span> <span class="n">stringsAsFactors</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="n">boxdf</span> <span class="o">&lt;-</span> <span class="n">transform</span><span class="p">(</span><span class="n">boxdf</span><span class="p">,</span> <span class="n">Year</span> <span class="o">=</span> <span class="n">ifelse</span><span class="p">(</span><span class="n">Year</span><span class="o">==</span><span class="m">0</span><span class="p">,</span> <span class="n">NA</span><span class="p">,</span> <span class="n">Year</span><span class="p">))</span>
<span class="k">return</span><span class="p">(</span><span class="n">boxdf</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>The data will come <code class="highlighter-rouge">dirty</code> with lots of tags and marks, so a little <a href="http://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html?_r=0">janitor work</a> will be  necessary. The following code does just that.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">CleanDataFrame</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">boxdf</span><span class="p">)</span> <span class="p">{</span>
<span class="n">clean</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="p">{</span>
<span class="n">col</span> <span class="o">&lt;-</span> <span class="n">gsub</span><span class="p">(</span><span class="s2">"$"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">fixed</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">col</span> <span class="o">&lt;-</span> <span class="n">gsub</span><span class="p">(</span><span class="s2">"%"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">fixed</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">col</span> <span class="o">&lt;-</span> <span class="n">gsub</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">fixed</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="n">col</span> <span class="o">&lt;-</span> <span class="n">gsub</span><span class="p">(</span><span class="s2">"^"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">col</span><span class="p">,</span> <span class="n">fixed</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>
<span class="k">return</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>
<span class="p">}</span>
<span class="n">boxdf</span> <span class="o">&lt;-</span> <span class="n">sapply</span><span class="p">(</span><span class="n">boxdf</span><span class="p">,</span> <span class="n">clean</span><span class="p">)</span>
<span class="n">boxdf</span> <span class="o">&lt;-</span> <span class="n">as.data.frame</span><span class="p">(</span><span class="n">boxdf</span><span class="p">,</span> <span class="n">stringsAsFactors</span><span class="o">=</span><span class="n">FALSE</span><span class="p">)</span>
<span class="k">return</span><span class="p">(</span><span class="n">boxdf</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>The next snippet is the main piece. It will construct the URLs based on the number of pages we feed in and will call the two preceding functions.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">BoxOfficeMojoScraper</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">npages</span><span class="p">)</span> <span class="p">{</span>
<span class="c1"># This line constructs the URLs
</span><span class="n">urls</span> <span class="o">&lt;-</span> <span class="n">paste</span><span class="p">(</span><span class="s2">"http://boxofficemojo.com/alltime/world/?pagenum="</span><span class="p">,</span> <span class="m">1</span><span class="o">:</span><span class="n">npages</span><span class="p">,</span> <span class="s2">"&amp;p=.htm"</span><span class="p">,</span> <span class="n">sep</span> <span class="o">=</span> <span class="s2">""</span><span class="p">)</span>
<span class="c1"># The next line scrapes every table in the URLs formed
</span><span class="n">boxdf</span> <span class="o">&lt;-</span> <span class="n">do.call</span><span class="p">(</span><span class="s2">"rbind"</span><span class="p">,</span> <span class="n">lapply</span><span class="p">(</span><span class="n">urls</span><span class="p">,</span> <span class="n">GetTable</span><span class="p">))</span>
<span class="c1"># This does the janitor work
</span><span class="n">boxdf</span> <span class="o">&lt;-</span> <span class="n">CleanDataFrame</span><span class="p">(</span><span class="n">boxdf</span><span class="p">)</span>
<span class="c1"># The next lines arrange the data to my needs
</span><span class="n">cols</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">4</span><span class="o">:</span><span class="m">9</span><span class="p">)</span>
<span class="n">boxdf</span><span class="p">[,</span> <span class="n">cols</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="n">sapply</span><span class="p">(</span><span class="n">boxdf</span><span class="p">[,</span> <span class="n">cols</span><span class="p">],</span> <span class="n">as.numeric</span><span class="p">)</span>
<span class="n">boxdf</span><span class="o">$</span><span class="n">Studio</span> <span class="o">&lt;-</span> <span class="n">as.factor</span><span class="p">(</span><span class="n">boxdf</span><span class="o">$</span><span class="n">Studio</span><span class="p">)</span>
<span class="k">return</span><span class="p">(</span><span class="n">boxdf</span><span class="p">)</span>
<span class="p">}</span></code></pre></figure>

<p>I’m scrapping the first 7 pages of the target address <a href="http://www.boxofficemojo.com/alltime/world/">http://www.boxofficemojo.com/alltime/world/</a>. It will bring missing values too, don’t worry for the time being.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">npages</span> <span class="o">&lt;-</span> <span class="m">7</span>
<span class="n">box</span> <span class="o">&lt;-</span> <span class="n">BoxOfficeMojoScraper</span><span class="p">(</span><span class="n">npages</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## Warning in lapply(X = X, FUN = FUN, ...): NAs introduced by coercion</code></pre></figure>

<h1 id="results">Results</h1>
<p>Our new acquired data is a data.frame with more than 620 rows or films, with the oldest dating back to 1939.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">str</span><span class="p">(</span><span class="n">box</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## 'data.frame':	628 obs. of  9 variables:
##  $ Rank       : num  1 2 3 4 5 6 7 8 9 10 ...
##  $ Title      : chr  "Avatar" "Titanic" "Jurassic World" "Star Wars: The Force Awakens" ...
##  $ Studio     : Factor w/ 38 levels "Art.","BV","Col.",..: 7 22 32 2 2 32 2 36 2 2 ...
##  $ Worldwide  : num  2788 2187 1669 1602 1520 ...
##  $ Domestic   : num  760 659 652 781 623 ...
##  $ DomesticPct: num  27.3 30.1 39.1 48.7 41 23.3 32.7 28.4 31.4 33.7 ...
##  $ Overseas   : num  2028 1528 1017 821 896 ...
##  $ OverseasPct: num  72.7 69.9 60.9 51.3 59 76.7 67.3 71.6 68.6 66.3 ...
##  $ Year       : num  2009 1997 2015 2015 2012 ...</code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># the oldest:
</span><span class="n">min</span><span class="p">(</span><span class="n">box</span><span class="o">$</span><span class="n">Year</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-text" data-lang="text">## [1] 1939</code></pre></figure>

<p>The following chart displays the grossing worldwide values for the top 25 ranked movies of all time. As it shines out, the <em>Star Wars: The Force Awakens_ is doing pretty well worldwide. It’s ranked fourth now, but it just began to play in China this week, so it may unseat *Titanic</em> over the next weeks, and <em>Avatar</em> in the long run.</p>

<p><img src="http://danielmarcelino.github.io/img/code-2016-01-11-star-wars-grossing-war/top25.png" alt="center" /></p>

<p>If you want to reproduce the very same plot decoration of this post, you’ll have to install the development version of <strong>SciencesPo</strong> package, and add <code class="highlighter-rouge">+ theme_538(legend="top")</code> to the following code.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">box2</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">Rank</span><span class="o">&lt;=</span><span class="m">25</span><span class="p">)</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">box2</span><span class="p">)</span> <span class="o">+</span>
<span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reorder</span><span class="p">(</span><span class="n">Title</span><span class="p">,</span> <span class="n">Worldwide</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">Worldwide</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"Worldwide"</span><span class="p">),</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">)</span> <span class="o">+</span>
<span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Title</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Domestic</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"Domestic"</span><span class="p">),</span><span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">)</span> <span class="o">+</span>
<span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Grossing"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">Worldwide</span><span class="o">=</span><span class="s2">"#A6CEE3"</span><span class="p">,</span> <span class="n">Domestic</span><span class="o">=</span><span class="s2">"#386CB0"</span><span class="p">))</span> <span class="o">+</span>
<span class="n">coord_flip</span><span class="p">()</span> <span class="o">+</span> 
 <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Top 25 Films by Worldwide Grosses (US$ Millions)"</span><span class="p">)</span> </code></pre></figure>

<p>Next, how <em>The Force Awakens</em> compares with other episodes of <em>Star Wars</em>?</p>

<p><img src="http://danielmarcelino.github.io/img/code-2016-01-11-star-wars-grossing-war/starwars.png" alt="center" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1"># will search for Star Wars names within the data.frame:
</span><span class="n">box3</span> <span class="o">&lt;-</span> <span class="n">subset</span><span class="p">(</span><span class="n">box</span><span class="p">,</span> <span class="n">grepl</span><span class="p">(</span><span class="s2">"^Star Wars"</span><span class="p">,</span> <span class="n">box</span><span class="o">$</span><span class="n">Title</span><span class="p">)</span><span class="o">|</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^Return of the Jedi"</span><span class="p">,</span> <span class="n">box</span><span class="o">$</span><span class="n">Title</span><span class="p">)</span><span class="o">|</span><span class="n">grepl</span><span class="p">(</span><span class="s2">"^The Empire Strikes Back"</span><span class="p">,</span> <span class="n">box</span><span class="o">$</span><span class="n">Title</span><span class="p">))</span>

<span class="c1"># will wrap the axis labels
</span><span class="n">wrap_20</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="n">gsub</span><span class="p">(</span><span class="s1">'(.{1,20})(\\s|$)'</span><span class="p">,</span> <span class="s1">'\\1\n'</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">ggplot</span><span class="p">(</span><span class="n">box3</span><span class="p">)</span> <span class="o">+</span>
<span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">reorder</span><span class="p">(</span><span class="n">wrap_20</span><span class="p">(</span><span class="n">Title</span><span class="p">),</span> <span class="n">Worldwide</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">Worldwide</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"Worldwide"</span><span class="p">),</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">)</span> <span class="o">+</span>
<span class="n">geom_bar</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">wrap_20</span><span class="p">(</span><span class="n">Title</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">Domestic</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"Domestic"</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span> <span class="n">stat</span> <span class="o">=</span> <span class="s2">"identity"</span><span class="p">)</span> <span class="o">+</span>
<span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">"Grossing"</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="n">Worldwide</span><span class="o">=</span><span class="s2">"#A6CEE3"</span><span class="p">,</span> <span class="n">Domestic</span><span class="o">=</span><span class="s2">"#386CB0"</span><span class="p">))</span> <span class="o">+</span>
<span class="n">coord_flip</span><span class="p">()</span> <span class="o">+</span> 
<span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">NULL</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">"Star Wars Grosses (US$ Millions)"</span><span class="p">)</span></code></pre></figure>

<p>The new release by Disney of <em>Star Wars</em> is making its way to the top films of all-time. Although the values presented are not in current currency, and old films in the list may have their grosses based on multiple releases, <em>The Force Awakens</em> has just began its journey.</p>
 ]]></content>
  </entry>
  
  <entry>
    <title>Gender Effect in Conference Talks</title>
    <link rel="alternate" type="text/html" href="/blog/2015/gender-effect-in-conference-talks.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=GenderEffectinConferenceTalks" />
    <published>2015-12-22T00:00:00Z</published>
    <updated>2015-12-22T00:00:00-02:00</updated>
    <id>/blog/2015/gender-effect-in-conference-talks</id>
    <content type="html"><![CDATA[ <p>I was searching in the arXiv repository for an interesting paper to read over the weekend, when I found this: <a href="http://arxiv.org/abs/1403.3091">“Studying Gender in Conference Talks – data from the 223rd meeting of the American Astronomical Society”</a>. The title and figures caught my attention more than the subject of the conference, I’ve to confess.</p>

<p>The plot below, taken from the paper, displays the most significant finding from the analysis: <em>a strong dependence on session chair gender</em>. Overall, males ask more question than females, but there is a large difference in number of questions asked by males vis-à-vis number asked by females, given a male or female chair. I’m wondering if this also holds for other science fields where the gap between male and female researchers is that not abnormal.</p>

<p><img src="http://danielmarcelino.github.io/img/2015/gender_chairs_n_questions.png" alt="Main Findings" /></p>

<p>The paper is stuffed with figures, but in this case I would prefer a table with residuals; way more telling.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">tab</span> <span class="o">=</span> <span class="n">as.table</span><span class="p">(</span><span class="n">matrix</span><span class="p">(</span><span class="n">c</span><span class="p">(</span><span class="m">63</span><span class="p">,</span> <span class="m">90</span><span class="p">,</span> <span class="m">122</span><span class="p">,</span> <span class="m">359</span><span class="p">),</span><span class="n">nrow</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span>
<span class="n">dimnames</span><span class="o">=</span><span class="n">list</span><span class="p">(</span><span class="n">chairs</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s1">'FC'</span><span class="p">,</span><span class="s1">'MC'</span><span class="p">),</span>
<span class="n">questions</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s1">'FQ'</span><span class="p">,</span> <span class="s1">'MQ'</span><span class="p">))))</span>

<span class="o">&gt;</span> <span class="n">tab</span>
     <span class="n">questions</span>
<span class="n">chairs</span>  <span class="n">FQ</span>  <span class="n">MQ</span>
   <span class="n">FC</span>  <span class="m">63</span> <span class="m">122</span>
   <span class="n">MC</span>  <span class="m">90</span> <span class="m">359</span>
      
<span class="n">dat</span> <span class="o">=</span> <span class="n">SciencesPo</span><span class="o">::</span><span class="n">untable</span><span class="p">(</span><span class="n">tab</span><span class="p">)</span>

<span class="o">&gt;</span> <span class="n">head</span><span class="p">(</span><span class="n">dat</span><span class="p">)</span>
  <span class="n">chairs</span> <span class="n">questions</span>
<span class="m">1</span>    <span class="n">FC</span>       <span class="n">FQ</span>
<span class="m">2</span>    <span class="n">FC</span>       <span class="n">FQ</span>
<span class="m">3</span>    <span class="n">FC</span>       <span class="n">FQ</span>
<span class="m">4</span>    <span class="n">FC</span>       <span class="n">FQ</span>
<span class="m">5</span>    <span class="n">FC</span>       <span class="n">FQ</span>
<span class="m">6</span>    <span class="n">FC</span>       <span class="n">FQ</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="o">&gt;</span> <span class="n">crosstabs</span><span class="p">(</span><span class="n">dat</span><span class="p">,</span> <span class="s2">"chairs"</span><span class="p">,</span> <span class="s2">"questions"</span><span class="p">,</span>
<span class="o">+</span>            <span class="n">row.pct</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span>
<span class="o">+</span>            <span class="n">chisq</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span>
<span class="o">+</span>            <span class="n">sresid</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span>

<span class="n">Table</span> <span class="n">of</span> <span class="n">chairs</span> <span class="n">by</span> <span class="n">questions</span>

                         <span class="o">|</span><span class="n">questions</span>  
<span class="o">-------------------------+-----------+-----------+-----------+</span>
<span class="n">chairs</span>                   <span class="o">|</span><span class="n">FQ</span>         <span class="o">|</span><span class="n">MQ</span>         <span class="o">|</span><span class="n">Total</span>      <span class="o">|</span>
<span class="o">-------------------------+-----------+-----------+-----------+</span>
<span class="n">FC</span>      <span class="o">|</span><span class="n">Obs</span> <span class="n">Freq</span>        <span class="o">|</span>         <span class="m">63</span><span class="o">|</span>        <span class="m">122</span><span class="o">|</span>        <span class="m">185</span><span class="o">|</span>
        <span class="o">|%</span> <span class="n">within</span> <span class="n">chairs</span> <span class="o">|</span>    <span class="m">34.0541</span><span class="o">|</span>    <span class="m">65.9459</span><span class="o">|</span>   <span class="m">100.0000</span><span class="o">|</span>
<span class="o">-------------------------+-----------+-----------+-----------+</span>
<span class="n">MC</span>      <span class="o">|</span><span class="n">Obs</span> <span class="n">Freq</span>        <span class="o">|</span>         <span class="m">90</span><span class="o">|</span>        <span class="m">359</span><span class="o">|</span>        <span class="m">449</span><span class="o">|</span>
        <span class="o">|%</span> <span class="n">within</span> <span class="n">chairs</span> <span class="o">|</span>    <span class="m">20.0445</span><span class="o">|</span>    <span class="m">79.9555</span><span class="o">|</span>   <span class="m">100.0000</span><span class="o">|</span>
<span class="o">-------------------------+-----------+-----------+-----------+</span>
<span class="n">Total</span>   <span class="o">|</span><span class="n">Obs</span> <span class="n">Freq</span>        <span class="o">|</span>        <span class="m">153</span><span class="o">|</span>        <span class="m">481</span><span class="o">|</span>        <span class="m">634</span><span class="o">|</span>
<span class="o">-------------------------+-----------+-----------+-----------+</span>

<span class="n">Statistics</span> <span class="k">for</span> <span class="n">Table</span> <span class="n">chairs</span> <span class="n">by</span> <span class="n">questions</span>

<span class="n">Statistics</span>                   <span class="n">DF</span>      <span class="n">Value</span>     <span class="n">Prob</span>
<span class="o">---------------------------------------------------</span>
<span class="n">Pearson</span> <span class="n">Chi</span><span class="o">-</span><span class="n">Square</span>           <span class="m">1</span>     <span class="m">13.2901</span>  <span class="m">0.0003</span>
<span class="n">Likelihood</span> <span class="n">Ratio</span> <span class="n">Chi</span><span class="o">-</span><span class="n">Square</span>  <span class="m">1</span>     <span class="m">13.4689</span>  <span class="m">0.0002</span>
<span class="n">Fisher</span><span class="err">'</span><span class="n">s</span> <span class="n">Exact</span> <span class="n">Test</span>                         <span class="m">0.0003</span>
<span class="o">---------------------------------------------------</span>

<span class="n">Residuals</span> <span class="k">for</span> <span class="n">Table</span> <span class="n">chairs</span> <span class="n">by</span> <span class="n">questions</span>

         <span class="o">|</span><span class="n">questions</span>  
<span class="o">---------+-----------+-----------+</span>
<span class="n">chairs</span>   <span class="o">|</span><span class="n">FQ</span>         <span class="o">|</span><span class="n">MQ</span>         <span class="o">|</span>
<span class="o">---------+-----------+-----------+</span>
<span class="n">FC</span>       <span class="o">|</span>     <span class="m">2.7470</span><span class="o">|</span>    <span class="m">-1.5493</span><span class="o">|</span>
<span class="n">MC</span>       <span class="o">|</span>    <span class="m">-1.7633</span><span class="o">|</span>     <span class="m">0.9945</span><span class="o">|</span>
<span class="o">---------+-----------+-----------+</span></code></pre></figure>
 ]]></content>
  </entry>
  
  <entry>
    <title>Venezuelan Parliamentary Election: What do the Polls Say?</title>
    <link rel="alternate" type="text/html" href="/blog/2015/venezuelan-parliamentary-elections.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=VenezuelanParliamentaryElection:WhatdothePollsSay?" />
    <published>2015-12-06T00:00:00Z</published>
    <updated>2015-12-06T00:00:00-02:00</updated>
    <id>/blog/2015/venezuelan-parliamentary-elections</id>
    <content type="html"><![CDATA[ <p>There is not a huge population of opinion polls covering this parliamentary election in Venezuela, but all I’ve can be used to gauge the public opinion by the local polling houses. This posting begs an obvious question: how has the mood in Venezuela varied over time with respect to voting intentions for the two political blocs? Next, can we detect any biases among those publishing polls?</p>

<!--more-->

<h1 id="the-data">The data</h1>
<p>I’ve collected some polls available on the internet dating back to January 2014, which I made available <a href="https://github.com/danielmarcelino/Polling/raw/master/Venezuela/data/polls.txt">here</a> after some <a href="http://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html?_r=0">data janitor work</a>.</p>

<h1 id="polls-over-time">Polls over time</h1>
<p>After a bit filling-in-the-blanks working with missing date values, we can visualize the poll trends over time. Given the sample size, sampling error and other sources of noise, a loess model can pretty much pick out the signals of long-term trends.</p>

<p><img src="http://danielmarcelino.github.io/img/code-2015-12-06-venezuelan-parliamentary-elections/loess-1.png" alt="center" /></p>

<h1 id="pollster-biases">Pollster biases</h1>
<p>Let’s pretend we can trust on all those polls despite the huge variability among them as already mentioned <a href="https://danielmarcelino.github.io/r/2015/12/04/venezuelan-parliamentary-election-2015/">here</a>. In fact, the problem is not the variability as such, but my lack of knowledge about who are the pollsters and their past performance, so I can’t judge them at first, let’s say it clearly.
Nonetheless, if we accept the above models as a sound estimate of the expected poll response at a given time, we can analyze the residuals of actual poll results and look for systematic biases. In theory, with a decent sample size (all have ~ 1300) and a reasonably stratified sampling method (I’m not even assuming  random samples here), we might expect polls results to be roughly normally distributed around the expected polls result, regardless of who performed or commissioned the poll, right?</p>

<p>The graph below shows the distributions per polling house for those who polled more than a single poll in this dataset.</p>

<p><img src="http://danielmarcelino.github.io/img/code-2015-12-06-venezuelan-parliamentary-elections/biases-3.png" alt="center" /></p>

<p>We’ve to keep in mind that there are important caveats which we’re not addressing here, as that different polls have used different question sets, methods etc, so this isn’t evidence for anything underhanded per se. It seems reasonable to expect that while parties might have good reasons to publish polls in their favor, pollsters conducting the polls should generally be more or less indifferent.</p>

<p>The results are hampered by a small number of data points per pollster, and that to claim they are polling significantly above or below expectation, save for the <em>Hercón</em>, which is significantly more pro opposition (MUD) than expected, given the probability laws, although the p-value is just above the 5% thumb/convention. With a little research, I figure out that <em>Datanálisis</em> performed fine in the previous elections, and here it appears just around the center of the distribution leaning toward the Socialists (PSUV).</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>pollster</strong></th>
      <th style="text-align: right"><strong>p</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Meganalisis</td>
      <td style="text-align: right">0.1875000</td>
    </tr>
    <tr>
      <td style="text-align: left">Venebarómetro</td>
      <td style="text-align: right">0.2500000</td>
    </tr>
    <tr>
      <td style="text-align: left">IVAD</td>
      <td style="text-align: right">0.4375000</td>
    </tr>
    <tr>
      <td style="text-align: left">ICS</td>
      <td style="text-align: right">0.5000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Delphos</td>
      <td style="text-align: right">1.0000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Datanálisis</td>
      <td style="text-align: right">0.7646484</td>
    </tr>
    <tr>
      <td style="text-align: left">VARIANZAS</td>
      <td style="text-align: right">1.0000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Consultores</td>
      <td style="text-align: right">0.2500000</td>
    </tr>
    <tr>
      <td style="text-align: left">DatinCorp</td>
      <td style="text-align: right">0.5625000</td>
    </tr>
    <tr>
      <td style="text-align: left">Keller y Asociados</td>
      <td style="text-align: right">0.2500000</td>
    </tr>
    <tr>
      <td style="text-align: left">Hercón</td>
      <td style="text-align: right">0.0625000</td>
    </tr>
  </tbody>
</table>

<h1 id="conclusion">Conclusion</h1>

<p>What do the polls say? Well, the majority of Venezuelans are favoring opposition candidates and this has been the trend for at least the latter two years, however polls appear to have been more variable in recent months. This election is expected to bring the opposition to control the National Assembly after 16 years loosing the elections in the country. 
The Venezuela’s Socialists seem to be at risk, but predicting the final number of seats is a tough task that I’m not considering in this post. 
In fact, it might be really difficult to set forth a range of winning seats as the government recently enacted some redistricting seats in order to weaken an eventual absolute majority by the opposition. Somehow, the polls show this will be a significant symbolic defeat for the government that shows it lost despite all the advantages in state power and control over the media.</p>

<h2 id="update-error">UPDATE (Error)</h2>
<p>I was informed by André Salvati that the code block below was producing an error message of unknown column; the missing part has been included. Thanks for letting me know. The whole code can be found in this <a href="https://gist.github.com/danielmarcelino/904c804b2681ac8a9d08">gist</a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"grid"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"reshape2"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"lubridate"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"scales"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"knitr"</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="s2">"SciencesPo"</span><span class="p">)</span> <span class="c1"># to use the themes, you must install the version from github
</span>
<span class="n">source</span> <span class="o">=</span> <span class="s2">"https://github.com/danielmarcelino/Polling/raw/master/Venezuela/data/polls.txt"</span>

<span class="n">data</span> <span class="o">&lt;-</span> <span class="n">read.csv</span><span class="p">(</span><span class="n">source</span><span class="p">,</span> <span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span> <span class="n">encoding</span> <span class="o">=</span> <span class="s2">"UTF-8"</span><span class="p">)</span>

<span class="c1"># Correcting for empty date values
</span><span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

<span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">lapply</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">as.Date</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="s2">"%d-%m-%Y"</span><span class="p">)</span>

<span class="n">times</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)(</span><span class="n">x</span><span class="o">*</span><span class="m">100</span><span class="p">)</span>

<span class="n">data</span><span class="p">[,</span><span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">lapply</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">],</span><span class="n">times</span><span class="p">)</span>

<span class="n">days</span> <span class="o">=</span> <span class="n">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="o">-</span><span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">is.na</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="p">)</span>

<span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">+</span><span class="n">days</span>

<span class="c1"># Find middle time point
</span><span class="n">DaysInField</span> <span class="o">=</span> <span class="n">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="o">-</span><span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">TRUE</span><span class="p">))</span>
<span class="n">data</span><span class="o">$</span><span class="n">date</span> <span class="o">=</span> <span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="o">+</span><span class="n">DaysInField</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">polls</span> <span class="o">&lt;-</span> <span class="n">melt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">id.vars</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"house"</span><span class="p">,</span> <span class="s2">"date"</span><span class="p">),</span> 
     <span class="n">measure.var</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"MUD"</span><span class="p">,</span> <span class="s2">"PSUV"</span><span class="p">,</span> <span class="s2">"Others"</span><span class="p">,</span> <span class="s2">"Undecided"</span><span class="p">))</span>
<span class="n">colnames</span><span class="p">(</span><span class="n">polls</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s2">"response"</span>
<span class="n">levels</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">response</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"MUD"</span><span class="p">,</span> <span class="s2">"PSUV"</span><span class="p">,</span> <span class="s2">"Others"</span><span class="p">,</span> <span class="s2">"Swing"</span><span class="p">)</span>


<span class="n">ggplot</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="n">response</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">response</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_point</span><span class="p">()</span> <span class="o">+</span> <span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"loess"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">I</span><span class="p">(</span><span class="m">.2</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">theme_538</span><span class="p">()</span> <span class="o">+</span> 
 <span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.95</span><span class="p">),</span> <span class="n">legend.direction</span><span class="o">=</span><span class="s2">"horizontal"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span> <span class="s2">"red"</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="s2">"grey40"</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span> <span class="s2">"red"</span><span class="p">,</span> <span class="s2">"orange"</span><span class="p">,</span> <span class="s2">"grey40"</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">scale_x_date</span><span class="p">(</span><span class="n">labels</span> <span class="o">=</span> <span class="n">date_format</span><span class="p">(</span><span class="s2">"%b '%y"</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">70</span><span class="p">,</span> <span class="m">10</span><span class="p">),</span> <span class="n">limits</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">70</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1.2</span><span class="p">,</span><span class="n">colour</span><span class="o">=</span><span class="s2">"#535353"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Vote Intention Among Venezuelans"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">"%"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="s2">"Poll response:"</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s2">"Poll response:"</span><span class="p">)</span>
<span class="c1"># credits
</span> <span class="n">geom_foot</span><span class="p">(</span><span class="s2">"danielmarcelino.github.io"</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## Residual analysis per pollster
</span><span class="n">l.MUD</span> <span class="o">&lt;-</span> <span class="n">loess</span><span class="p">(</span><span class="n">value</span> <span class="o">~</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">response</span><span class="o">==</span><span class="s2">"MUD"</span><span class="p">))</span>
<span class="n">l.PSUV</span> <span class="o">&lt;-</span> <span class="n">loess</span><span class="p">(</span><span class="n">value</span> <span class="o">~</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">response</span><span class="o">==</span><span class="s2">"PSUV"</span><span class="p">))</span>
<span class="n">l.Others</span> <span class="o">&lt;-</span> <span class="n">loess</span><span class="p">(</span><span class="n">value</span> <span class="o">~</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">response</span><span class="o">==</span><span class="s2">"Others"</span><span class="p">))</span>
<span class="n">l.Swing</span> <span class="o">&lt;-</span> <span class="n">loess</span><span class="p">(</span><span class="n">value</span> <span class="o">~</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">response</span><span class="o">==</span><span class="s2">"Swing"</span><span class="p">))</span>

<span class="n">with</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">plot</span><span class="p">(</span><span class="n">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span> <span class="n">value</span><span class="p">))</span>
<span class="n">lines</span><span class="p">(</span><span class="n">as.numeric</span><span class="p">(</span><span class="n">polls</span><span class="p">[</span><span class="n">polls</span><span class="o">$</span><span class="n">response</span> <span class="o">==</span> <span class="s2">"MUD"</span><span class="p">,]</span><span class="o">$</span><span class="n">date</span><span class="p">),</span>
      <span class="n">predict</span><span class="p">(</span><span class="n">l.MUD</span><span class="p">,</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">polls</span><span class="p">[</span><span class="n">polls</span><span class="o">$</span><span class="n">response</span> <span class="o">==</span> <span class="s2">"MUD"</span><span class="p">,]</span><span class="o">$</span><span class="n">date</span><span class="p">)))</span>

<span class="c1"># Calculate predicted values per row, 
</span><span class="n">polls</span><span class="o">$</span><span class="n">predicted</span> <span class="o">&lt;-</span> <span class="n">NA</span>

<span class="n">loessPrediction</span> <span class="o">&lt;-</span> <span class="k">function</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span> <span class="n">model</span><span class="p">){</span>
  <span class="n">rows</span> <span class="o">&lt;-</span> <span class="n">polls</span><span class="o">$</span><span class="n">response</span> <span class="o">==</span> <span class="n">resp</span>
  <span class="n">curr</span> <span class="o">&lt;-</span> <span class="n">polls</span><span class="p">[</span><span class="n">rows</span><span class="p">,]</span>
  <span class="n">preds</span> <span class="o">&lt;-</span> <span class="n">with</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span> <span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">)))</span>
  <span class="n">polls</span><span class="p">[</span><span class="n">rows</span><span class="p">,]</span><span class="o">$</span><span class="n">predicted</span> <span class="o">&lt;&lt;-</span> <span class="n">preds</span>
<span class="p">}</span>

<span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"MUD"</span><span class="p">,</span> <span class="n">l.MUD</span><span class="p">)</span>
<span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"PSUV"</span><span class="p">,</span> <span class="n">l.PSUV</span><span class="p">)</span>
<span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"Others"</span><span class="p">,</span> <span class="n">l.Others</span><span class="p">)</span>
<span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"Swing"</span><span class="p">,</span> <span class="n">l.Swing</span><span class="p">)</span>

<span class="n">polls</span><span class="o">$</span><span class="n">residual</span> <span class="o">&lt;-</span> <span class="n">polls</span><span class="o">$</span><span class="n">value</span> <span class="o">-</span> <span class="n">polls</span><span class="o">$</span><span class="n">predicted</span>
<span class="n">hist</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">residual</span><span class="p">)</span>

<span class="c1">## Check pollsters' names
</span><span class="n">polls</span><span class="o">$</span><span class="n">house</span> <span class="o">&lt;-</span> <span class="n">gsub</span><span class="p">(</span><span class="s2">" ?\\(.*"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="p">)</span>
<span class="n">polls</span><span class="o">$</span><span class="n">house</span> <span class="o">&lt;-</span> <span class="n">gsub</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="s2">" "</span><span class="p">,</span> <span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="p">)</span>

<span class="n">houseNames</span> <span class="o">&lt;-</span> <span class="n">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span> <span class="n">strsplit</span><span class="p">(</span><span class="n">as.character</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="p">),</span> <span class="s2">"/"</span><span class="p">))</span>
<span class="n">colnames</span><span class="p">(</span><span class="n">houseNames</span><span class="p">)</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"pollster"</span><span class="p">,</span> <span class="s2">"commission"</span><span class="p">)</span>

<span class="n">polls</span> <span class="o">&lt;-</span> <span class="n">cbind</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">houseNames</span><span class="p">)</span>

<span class="c1">## Order pollster by median residual:
</span><span class="n">ordering</span> <span class="o">&lt;-</span> <span class="n">group_by</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">pollster</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">filter</span><span class="p">(</span><span class="n">response</span> <span class="o">==</span> <span class="s2">"MUD"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">summarize</span><span class="p">(</span><span class="n">med</span> <span class="o">=</span> <span class="n">median</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="n">T</span><span class="p">),</span> <span class="n">count</span><span class="o">=</span><span class="n">n</span><span class="p">())</span> <span class="o">%&gt;%</span>
  <span class="n">arrange</span><span class="p">(</span><span class="n">med</span><span class="p">)</span> 

<span class="n">polls</span><span class="o">$</span><span class="n">pollster</span> <span class="o">&lt;-</span> <span class="n">factor</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">pollster</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">ordering</span><span class="o">$</span><span class="n">pollster</span><span class="p">)</span>

<span class="c1">## Testing for biases by a given pollster 
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span> <span class="n">response</span> <span class="o">==</span> <span class="s2">"MUD"</span><span class="p">),</span> 
       <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pollster</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">residual</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0</span><span class="p">))</span> <span class="o">+</span>
  <span class="n">geom_violin</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="s2">"width"</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="n">I</span><span class="p">(</span><span class="s2">"grey50"</span><span class="p">),</span> <span class="n">col</span><span class="o">=</span><span class="n">I</span><span class="p">(</span><span class="s2">"grey50"</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">geom_jitter</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_jitter</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.05</span><span class="p">))</span> <span class="o">+</span> 
  <span class="n">stat_summary</span><span class="p">(</span><span class="n">geom</span> <span class="o">=</span> <span class="s2">"crossbar"</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="m">0.75</span><span class="p">,</span> <span class="n">fatten</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> 
               <span class="n">color</span><span class="o">=</span><span class="s2">"grey20"</span><span class="p">,</span> <span class="n">fun.y</span><span class="o">=</span><span class="n">median</span><span class="p">,</span> <span class="n">fun.ymin</span><span class="o">=</span><span class="n">median</span><span class="p">,</span> <span class="n">fun.ymax</span><span class="o">=</span><span class="n">median</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">coord_flip</span><span class="p">()</span> <span class="o">+</span> <span class="n">theme_538</span><span class="p">()</span> <span class="o">+</span> <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Relative MUD voting intentions"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Polling house"</span><span class="p">,</span>
       <span class="n">y</span><span class="o">=</span><span class="s2">"Comparison with other polls at the time"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ylim</span><span class="p">(</span><span class="m">-12</span><span class="p">,</span><span class="m">12</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## Stats significance, is it any?
</span><span class="n">options</span><span class="p">(</span><span class="n">scipen</span><span class="o">=</span><span class="m">0</span><span class="p">)</span>
<span class="n">sigTable</span> <span class="o">&lt;-</span> <span class="n">polls</span> <span class="o">%&gt;%</span> <span class="n">filter</span><span class="p">(</span><span class="n">response</span> <span class="o">==</span> <span class="s2">"MUD"</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">group_by</span><span class="p">(</span> <span class="n">pollster</span><span class="p">)</span> <span class="o">%&gt;%</span>
  <span class="n">summarise</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">wilcox.test</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="o">$</span><span class="n">p.value</span><span class="p">)</span> 
<span class="n">kable</span><span class="p">(</span><span class="n">sigTable</span><span class="p">)</span></code></pre></figure>

 ]]></content>
  </entry>
  
  <entry>
    <title>Venezuela&#39;s 2015 Parliamentary Elections</title>
    <link rel="alternate" type="text/html" href="/blog/2015/venezuelan-parliamentary-election-2015.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=Venezuela&#39;s2015ParliamentaryElections" />
    <published>2015-12-04T00:00:00Z</published>
    <updated>2015-12-04T00:00:00-02:00</updated>
    <id>/blog/2015/venezuelan-parliamentary-election-2015</id>
    <content type="html"><![CDATA[ <p>Next Sunday Venezuelans are heading to the polls once again with  international concerns about the clearness of the balloting. To get an idea about the political climate over there, I’ve collected some polls available on the internet. The surprising thing from those surveys is a tremendous variability from pollster to pollster about the single topic of voting intention. You may find national polls fielded in the same period with estimates varying as much as 20%, isn’t it dramatic? If you always wanted to see house bias operating in practice, the Venezuelan elections may provide you a good case then.</p>

<p><img src="http://danielmarcelino.github.io/img/2015/venezuela1.png" alt="center" /></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### The data
</span><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">SciencesPo</span><span class="p">)</span> 

<span class="n">source</span> <span class="o">=</span> <span class="s2">"https://github.com/danielmarcelino/Polling/raw/master/Venezuela/data/polls.txt"</span>

<span class="n">data</span> <span class="o">&lt;-</span> <span class="n">getdata</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>

<span class="n">data</span><span class="o">$</span><span class="n">begin</span> <span class="o">&lt;-</span> <span class="n">as.Date</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="s2">"%d-%m-%Y"</span><span class="p">)</span>
<span class="c1"># just interested in some period
</span><span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data</span> <span class="o">%&gt;%</span> 
  <span class="n">filter</span><span class="p">(</span><span class="n">begin</span><span class="o">&gt;</span><span class="n">as.Date</span><span class="p">(</span><span class="s2">"01-07-2014"</span><span class="p">,</span> <span class="n">format</span> <span class="o">=</span> <span class="s2">"%d-%m-%Y"</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">### The plot
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">begin</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">MUD</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">),</span><span class="n">color</span><span class="o">=</span><span class="s2">"gray25"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">begin</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">PSUV</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">3</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s2">"tomato"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1.2</span><span class="p">,</span><span class="n">colour</span><span class="o">=</span><span class="s2">"#535353"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">plotTitleSubtitle</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Vote Intentions for the Gop (MUD) and Gov't (PSUV)"</span><span class="p">,</span> <span class="n">subtitle</span><span class="o">=</span><span class="s2">"Black = MUD, Red = PSUV"</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">theme_538</span><span class="p">()</span>
<span class="c1"># credits
</span>  <span class="n">plotFootnote</span><span class="p">(</span><span class="s2">"danielmarcelino.github.io"</span><span class="p">)</span></code></pre></figure>

 ]]></content>
  </entry>
  
  <entry>
    <title>Retrieving Data from Google Books with `ngramr`</title>
    <link rel="alternate" type="text/html" href="/blog/2015/retrieving-data-from-google-books-with-ngramr.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=RetrievingDatafromGoogleBookswith`ngramr`" />
    <published>2015-11-15T00:00:00Z</published>
    <updated>2015-11-15T00:00:00-02:00</updated>
    <id>/blog/2015/retrieving-data-from-google-books-with-ngramr</id>
    <content type="html"><![CDATA[ <p><a href="https://en.wikipedia.org/wiki/Karl_Marx">Karl Marx</a> is the most famous founding fathers of modern sociology with a popularity peak in 1975-6, but declining ever since my little research using the <a href="https://books.google.com/ngrams">Google Ngram Viewer</a> suggests.</p>

<h2 id="introduction">Introduction</h2>
<p>Google has a tool for tracking the frequency of words or phrases across its vast collection of scanned texts, the Google Books. The <a href="https://books.google.com/ngrams">Google Ngram Viewer</a> reports data and graphs the frequency of words encountered in one or across several <em>corpus</em> over time. For instance, the chart below campares the appearance in the English <em>corpus</em> of following bigrams names: “Karl Marx”, “Max Weber”, “Emile Durkheim”.</p>

<p><img src="http://danielmarcelino.github.io/img/code-2015-11-15-retrieving-data-from-google-books-with-ngramr/GoogleNgram.png" alt="center" /></p>

<p>The y-axis shows of all the bigrams contained in the sample of books written in English, what percentage of them are “Karl Marx” or “Max Weber” or “Emile Durkheim”? From the chart above, we can conclude that Marx is the most famous sociologist among the others founding fathers, with a peak in popularity about 1975-6, but his influence has been declining ever since. These thinkers are considered the founding fathers of sociology because they set out to develop practical and scientifically sound methods of research to examine theories of the social world rooted in a specific historical and cultural context.</p>

<h2 id="using-r-with-google-ngram-viewer">Using R with Google Ngram Viewer</h2>

<p>There is a package to query the Google Ngram called <a href="https://cran.r-project.org/web/packages/ngramr/index.html">ngramr</a> written by Sean Carmody. With this package, one can retrieve data from Ngram pages in the form of data frame.</p>

<h2 id="getting-started">Getting Started</h2>
<p>The first thing to do is to load the <code class="highlighter-rouge">ggplot2</code> and <code class="highlighter-rouge">ngramr</code> packages. In case you don’t have them installed, an installation is required.</p>

<h2 id="write-a-query-and-do-the-plots">Write a Query and Do the Plots</h2>

<p>The following is equivalent to the chart above for the three sociologists bigrams, except that I’m applying a smoothed line–or moving average of 5 years, so trends become more apparent. For instance, the data shown for 2000 is an average of the raw count for 2000 plus 5 values on either side: (“count for 1995” + “count for 2000” + “count for 2005”), divided by 3. So a smoothing of 5 means that 11 values will be averaged: 5 on either side, plus the target value in the center of them.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ng</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"(Karl Marx)"</span><span class="p">,</span> <span class="s2">"(Max Weber)"</span><span class="p">,</span> <span class="s2">"(Emile Durkheim)"</span><span class="p">)</span> 
<span class="n">ggram</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">year_start</span> <span class="o">=</span> <span class="m">1800</span><span class="p">,</span> 
      <span class="n">year_end</span> <span class="o">=</span> <span class="m">2012</span><span class="p">,</span>  
      <span class="n">smoothing</span> <span class="o">=</span> <span class="m">5</span><span class="p">,</span>
      <span class="n">google_theme</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Marx, Weber, Durkheim"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme_538</span><span class="p">(</span><span class="n">legend.position</span> <span class="o">=</span> <span class="s2">"bottom"</span><span class="p">)</span></code></pre></figure>

<p><img src="http://danielmarcelino.github.io/img/code-2015-11-15-retrieving-data-from-google-books-with-ngramr/sociologists-1.png" alt="center" /></p>

<h2 id="complex-queries">Complex Queries</h2>

<p>I test the trend in popularity of the unigran “Capitalism” vis-à-vis other two unigrans (“Socialism”, “Communism”) from 1850 to 2012. Here’s how we might combine + and / to show how the unigram “Capitalism” has blossomed at the expense of “Socialism” and “Communism” terms in the literature published in English.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ng</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Capitalism /(Capitalism + Socialism + Communism)"</span><span class="p">)</span>
<span class="n">cap</span> <span class="o">&lt;-</span> <span class="n">ggram</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">year_start</span> <span class="o">=</span> <span class="m">1850</span><span class="p">,</span> 
      <span class="n">year_end</span> <span class="o">=</span> <span class="m">2012</span><span class="p">,</span>  
      <span class="n">smoothing</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>
      <span class="n">google_theme</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Capitalism over (Capitalism + Socialism + Communism)"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme_538</span><span class="p">()</span>

<span class="n">ng</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Socialism /(Capitalism + Socialism + Communism)"</span><span class="p">)</span>
<span class="n">soc</span> <span class="o">&lt;-</span> <span class="n">ggram</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">year_start</span> <span class="o">=</span> <span class="m">1850</span><span class="p">,</span> 
      <span class="n">year_end</span> <span class="o">=</span> <span class="m">2012</span><span class="p">,</span>  
      <span class="n">smoothing</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>
      <span class="n">google_theme</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Socialism over (Capitalism + Socialism + Communism)"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme_538</span><span class="p">()</span>

<span class="n">ng</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="s2">"Communism /(Capitalism + Socialism + Communism)"</span><span class="p">)</span>
<span class="n">com</span> <span class="o">&lt;-</span> <span class="n">ggram</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">year_start</span> <span class="o">=</span> <span class="m">1850</span><span class="p">,</span> 
      <span class="n">year_end</span> <span class="o">=</span> <span class="m">2012</span><span class="p">,</span>  
      <span class="n">smoothing</span> <span class="o">=</span> <span class="m">3</span><span class="p">,</span>
      <span class="n">google_theme</span> <span class="o">=</span> <span class="n">FALSE</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Communism over (Capitalism + Socialism + Communism)"</span><span class="p">)</span><span class="o">+</span>
    <span class="n">theme_538</span><span class="p">()</span>
<span class="n">multiplot</span><span class="p">(</span><span class="n">cap</span><span class="p">,</span> <span class="n">soc</span><span class="p">,</span> <span class="n">com</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="n">ggfootnote</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span></code></pre></figure>

<p><img src="http://danielmarcelino.github.io/img/code-2015-11-15-retrieving-data-from-google-books-with-ngramr/Capitalism Popularity-1.png" alt="center" /></p>

<p>In the following, I retrieve the frequency for the unigram “Capitalism” in the Russian <em>corpus</em>, French, and British English. Note that the results can be case-insensitive variants.</p>

<p>Below is a plot of the unigram “Capitalism” (“капитализм”) in the Russian language <em>corpus</em>.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">ng</span> <span class="o">&lt;-</span> <span class="s2">"капитализм"</span>
<span class="n">rus</span><span class="o">=</span><span class="n">ggram</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">year_start</span> <span class="o">=</span> <span class="m">1850</span><span class="p">,</span> 
      <span class="n">corpus</span> <span class="o">=</span> <span class="s2">"rus_2012"</span><span class="p">,</span>
      <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> 
      <span class="n">google_theme</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Russian: капитализм"</span><span class="p">)</span><span class="o">+</span>
     <span class="n">theme_538</span><span class="p">()</span>

<span class="n">ng</span> <span class="o">&lt;-</span> <span class="s2">"capitalisme"</span>
<span class="n">fre</span><span class="o">=</span><span class="n">ggram</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">year_start</span> <span class="o">=</span> <span class="m">1850</span><span class="p">,</span> 
      <span class="n">corpus</span> <span class="o">=</span> <span class="s2">"fre_2012"</span><span class="p">,</span>
      <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> 
      <span class="n">google_theme</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"French: Capitalisme"</span><span class="p">)</span><span class="o">+</span>
     <span class="n">theme_538</span><span class="p">()</span>

<span class="n">ng</span> <span class="o">&lt;-</span> <span class="s2">"capitalism"</span>
<span class="n">eng</span><span class="o">=</span><span class="n">ggram</span><span class="p">(</span><span class="n">ng</span><span class="p">,</span> <span class="n">year_start</span> <span class="o">=</span> <span class="m">1850</span><span class="p">,</span> 
      <span class="n">corpus</span> <span class="o">=</span> <span class="s2">"eng_gb_2012"</span><span class="p">,</span>
      <span class="n">ignore_case</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">,</span> 
      <span class="n">google_theme</span> <span class="o">=</span> <span class="n">TRUE</span><span class="p">)</span> <span class="o">+</span>
    <span class="n">ggtitle</span><span class="p">(</span><span class="s2">"English: Capitalism"</span><span class="p">)</span><span class="o">+</span>
     <span class="n">theme_538</span><span class="p">()</span>

<span class="n">multiplot</span><span class="p">(</span><span class="n">rus</span><span class="p">,</span> <span class="n">fre</span><span class="p">,</span> <span class="n">eng</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="m">1</span><span class="p">)</span>
<span class="n">ggfootnote</span><span class="p">(</span><span class="n">size</span> <span class="o">=</span> <span class="m">.5</span><span class="p">)</span></code></pre></figure>

<p><img src="http://danielmarcelino.github.io/img/code-2015-11-15-retrieving-data-from-google-books-with-ngramr/capitalism-1.png" alt="center" /></p>

 ]]></content>
  </entry>
  
  <entry>
    <title>Competing views on Argentina&#39;s Frontrunner</title>
    <link rel="alternate" type="text/html" href="/blog/2015/competing-views-in-argentina.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=CompetingviewsonArgentina&#39;sFrontrunner" />
    <published>2015-10-30T00:00:00Z</published>
    <updated>2015-10-30T00:00:00-02:00</updated>
    <id>/blog/2015/competing-views-in-argentina</id>
    <content type="html"><![CDATA[ <p>The last poll published today by <em>Polldata</em> put Scioli below 40%, with about 5% reporting being undecided.
It might be too early to state anything solid, but the few polls prospecting the runoff election in Argentina seem to be telling two distinct histories. Polling houses <em>Hugo Haime</em> and <em>IPSOS</em> suggest that Daniel Scioli is going up while <em>Elypsis</em>  and <em>Polldata</em> say he’s actually sinking as the weeks go by. The last poll published today by <em>Polldata</em> puts Scioli below 40%, with about 5% reporting being undecided. My experience following  multiparty elections suggests that polls perform much better in the runoff than in primaries, meaning that the average of the polls now is much more close to the real vote preference than reported before.</p>

<p><img src="http://danielmarcelino.github.io/img/2015/Daniel_Scioli_Gross_lm.png" alt="" /></p>

 ]]></content>
  </entry>
  
  <entry>
    <title>House Effects in Argentinian polling</title>
    <link rel="alternate" type="text/html" href="/blog/2015/argentine-house-effects.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=HouseEffectsinArgentinianpolling" />
    <published>2015-10-25T00:00:00Z</published>
    <updated>2015-10-25T00:00:00-02:00</updated>
    <id>/blog/2015/argentine-house-effects</id>
    <content type="html"><![CDATA[ <p>I’ve already <a href="http://danielmarcelino.com/r/08-2015/Argentine-general-election-2015/">posted</a> previously on “house effects”, the tendency of polling organizations to systematically vary in their results from one another. In this post, I look specifically at these house effects, and show which polling organizations over or under-estimate support for each candidate–compared to the average–in this presidential election in Argentina.</p>

<p>The graph below plots the house effects for the main presidential candidates considering more than 115 polls that I’ve collected since 2014.</p>

<p><img src="http://danielmarcelino.github.io/img/2015/3d-house-effects_argentine.png" alt="House Effects" /></p>

<p>In essence, the house effects measure how far polls by a pollster are from what would be expected based on trends over time for the average polling house. In other words, the average house effect toward each candidate/party is expected to be zero by design. Then, a poll that is systematically 2% below what would be predicted for the date the poll was conducted will have a house effect of -2.0%.</p>

<p>The dots in “red” in the plot represent the pollster whose house effects were negative toward Mauricio Macri, while dots in “blue” represent positive effects toward him.</p>

<p>The electoral result tonight was a bit of surprise as several pollsters didn’t seem to have pick out a crescendo preference for the opposition candidate, Mauricio Macri, among undecided voters over the last week. <a href="http://us3.campaign-archive1.com/?u=6b1e9fcb4df3eaee1cd635f50&amp;id=0e702eecac&amp;e=c2780c4e4b">This blog</a> has more details.</p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">scatterplot3d</span><span class="p">)</span>
<span class="n">houseEffects</span><span class="o">$</span><span class="n">pcolor</span><span class="p">[</span><span class="n">houseEffects</span><span class="o">$</span><span class="n">Macri</span><span class="o">&lt;</span> <span class="m">0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s2">"red"</span>
<span class="n">houseEffects</span><span class="o">$</span><span class="n">pcolor</span><span class="p">[</span><span class="n">houseEffects</span><span class="o">$</span><span class="n">Macri</span><span class="o">&gt;=</span><span class="m">0</span><span class="p">]</span> <span class="o">&lt;-</span> <span class="s2">"blue"</span>

<span class="n">with</span><span class="p">(</span><span class="n">houseEffects</span><span class="p">,</span> <span class="p">{</span>
  <span class="n">s3d</span> <span class="o">&lt;-</span> <span class="n">scatterplot3d</span><span class="p">(</span><span class="n">Scioli</span><span class="p">,</span> <span class="n">Massa</span><span class="p">,</span> <span class="n">Macri</span><span class="p">,</span> <span class="c1"># x y and z axis
</span>                       <span class="n">angle</span><span class="o">=</span><span class="m">30</span><span class="p">,</span> <span class="c1"># angle of the plot 
</span>                       <span class="n">color</span><span class="o">=</span><span class="n">pcolor</span><span class="p">,</span> <span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span> <span class="c1"># filled blue circles
</span>                       <span class="n">type</span><span class="o">=</span><span class="s2">"h"</span><span class="p">,</span> <span class="c1"># vertical lines to the x-y plane
</span>                       <span class="n">main</span><span class="o">=</span><span class="s2">"House Effects"</span><span class="p">,</span>
                       <span class="n">xlab</span><span class="o">=</span><span class="s2">"Daniel Scioli"</span><span class="p">,</span>
                       <span class="n">ylab</span><span class="o">=</span><span class="s2">"Sergio Massa"</span><span class="p">,</span>
                       <span class="n">zlab</span><span class="o">=</span><span class="s2">"Mauricio Macri"</span><span class="p">)</span>

  <span class="n">s3d.coords</span> <span class="o">&lt;-</span> <span class="n">s3d</span><span class="o">$</span><span class="n">xyz.convert</span><span class="p">(</span><span class="n">Scioli</span><span class="p">,</span> <span class="n">Massa</span><span class="p">,</span> <span class="n">Macri</span><span class="p">)</span> <span class="c1"># convert 3D coords to 2D projection
</span>  <span class="n">text</span><span class="p">(</span><span class="n">s3d.coords</span><span class="o">$</span><span class="n">x</span><span class="p">,</span> <span class="n">s3d.coords</span><span class="o">$</span><span class="n">y</span><span class="p">,</span>  <span class="c1"># x and y coordinates
</span>       <span class="n">labels</span><span class="o">=</span><span class="n">Pollster</span><span class="p">,</span>  <span class="c1"># text to plot
</span>       <span class="n">cex</span><span class="o">=</span><span class="m">.5</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="m">4</span><span class="p">)</span> <span class="c1"># shrink text 50% and place to right of points)
</span>  <span class="n">legend</span><span class="p">(</span><span class="s2">"topleft"</span><span class="p">,</span> <span class="n">inset</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="c1"># location and inset
</span>         <span class="n">bty</span><span class="o">=</span><span class="s2">"n"</span><span class="p">,</span> <span class="n">cex</span><span class="o">=</span><span class="m">.7</span><span class="p">,</span>  <span class="c1"># suppress legend box, shrink text 70%
</span>         <span class="n">title</span><span class="o">=</span><span class="s2">"House effects toward\nDaniel Scioli"</span><span class="p">,</span>
         <span class="n">c</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span> <span class="s2">"+"</span><span class="p">),</span> <span class="n">fill</span><span class="o">=</span><span class="n">c</span><span class="p">(</span><span class="s2">"red"</span><span class="p">,</span> <span class="s2">"blue"</span><span class="p">))</span>
<span class="p">})</span></code></pre></figure>

 ]]></content>
  </entry>
  
  <entry>
    <title>Paranormal Distribution</title>
    <link rel="alternate" type="text/html" href="/blog/2015/paranormal-distribution.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=ParanormalDistribution" />
    <published>2015-10-20T00:00:00Z</published>
    <updated>2015-10-20T00:00:00-02:00</updated>
    <id>/blog/2015/paranormal-distribution</id>
    <content type="html"><![CDATA[ <p>What if, instead of a normal, you got a paranormal distribution?
In case you want to read an influential paper on this matter, you can find it <a href="http://www.ncbi.nlm.nih.gov/pmc/articles/PMC2465539/">here</a>.</p>

<p><img src="http://danielmarcelino.github.io/img/2015/paranormal.png" alt="Paranormal Distribution" /></p>

<h4 id="load-packages-and-set-up-the-theme">Load packages and set up the theme</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>
<span class="n">library</span><span class="p">(</span><span class="n">gridExtra</span><span class="p">)</span>

<span class="n">theme_old</span> <span class="o">&lt;-</span> <span class="n">theme</span><span class="p">(</span><span class="n">panel.grid.minor</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">panel.grid.major</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">panel.background</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">plot.background</span> <span class="o">=</span> <span class="n">element_rect</span><span class="p">(</span><span class="n">fill</span><span class="o">=</span><span class="s2">"#F9F0Ea"</span><span class="p">),</span>
                   <span class="n">panel.border</span> <span class="o">=</span>  <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">axis.line</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">axis.text.x</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">axis.text.y</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">colour</span><span class="o">=</span><span class="n">NA</span><span class="p">),</span>
                   <span class="c1"># axis.text.y = element_blank(),
</span>                   <span class="n">axis.ticks</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">axis.title.x</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">axis.title.y</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
<span class="c1"># I'm using xkcd fonts, replace or install if you don't have it.
</span>                   <span class="n">text</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">14</span><span class="p">,</span> <span class="n">family</span><span class="o">=</span><span class="s2">"xkcd"</span><span class="p">),</span>
                   <span class="n">axis.line</span> <span class="o">=</span> <span class="n">element_line</span><span class="p">(</span><span class="n">colour</span> <span class="o">=</span> <span class="s2">"black"</span><span class="p">,</span> <span class="n">linetype</span> <span class="o">=</span> <span class="s2">"solid"</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">1</span><span class="p">),</span>
                   <span class="n">axis.line.y</span> <span class="o">=</span> <span class="n">element_blank</span><span class="p">(),</span>
                   <span class="n">plot.title</span> <span class="o">=</span> <span class="n">element_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">22</span><span class="p">))</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">#### Make a "normal" normal distribution 
</span><span class="n">gplot1</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data.frame</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span> <span class="m">3</span><span class="p">)),</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="n">stat_function</span><span class="p">(</span><span class="n">fun</span> <span class="o">=</span> <span class="n">dnorm</span><span class="p">)</span> <span class="o">+</span> <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">"Normal Distribution"</span><span class="p">)</span> <span class="o">+</span> <span class="n">theme_old</span></code></pre></figure>

<h4 id="make-a-floating-dress-for-the-paranormal-distribution">Make a floating dress for the paranormal distribution</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"> 
<span class="n">a</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span> <span class="m">-1.5</span><span class="p">,</span> <span class="m">-0.9</span><span class="p">,</span> <span class="m">-0.3</span><span class="p">,</span> <span class="m">0.6</span><span class="p">,</span> <span class="m">1</span><span class="p">,</span> <span class="m">1.5</span><span class="p">,</span> <span class="m">2</span><span class="p">,</span> <span class="m">3</span><span class="p">)</span>
<span class="n">b</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">0.004431848</span><span class="p">,</span> <span class="m">0.03</span><span class="p">,</span> <span class="m">0.0044</span><span class="p">,</span> <span class="m">0.03</span><span class="p">,</span> <span class="m">0.01</span><span class="p">,</span> <span class="m">0.030</span><span class="p">,</span> <span class="m">0.0044</span><span class="p">,</span> <span class="m">0.015</span><span class="p">,</span> <span class="m">0.004431848</span><span class="p">)</span>

<span class="n">data</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">)</span>
<span class="n">c</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">-0.40</span><span class="p">,</span> <span class="m">0.04</span><span class="p">)</span>
<span class="n">d</span> <span class="o">&lt;-</span> <span class="n">c</span><span class="p">(</span><span class="m">0.27</span><span class="p">,</span> <span class="m">0.27</span><span class="p">)</span>
<span class="n">data2</span> <span class="o">&lt;-</span> <span class="n">data.frame</span><span class="p">(</span><span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">d</span><span class="p">)</span></code></pre></figure>

<h4 id="plot-paranormal-distribution">Plot paranormal distribution</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">gplot2</span> <span class="o">&lt;-</span> <span class="n">ggplot</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">b</span><span class="p">))</span> <span class="o">+</span> <span class="n">geom_line</span><span class="p">()</span>
<span class="n">gplot2</span> <span class="o">&lt;-</span> <span class="n">gplot2</span> <span class="o">+</span> <span class="n">stat_function</span><span class="p">(</span><span class="n">fun</span> <span class="o">=</span> <span class="n">dnorm</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">data2</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="p">),</span> <span class="n">pch</span><span class="o">=</span><span class="mh">0x30</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">6</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">geom_point</span><span class="p">(</span><span class="n">data</span> <span class="o">=</span> <span class="n">data2</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">c</span><span class="m">-0.008</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">d</span><span class="m">-0.006</span><span class="p">),</span> <span class="n">pch</span><span class="o">=</span><span class="m">19</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">)</span> <span class="o">+</span>
  <span class="n">labs</span><span class="p">(</span><span class="n">title</span> <span class="o">=</span> <span class="s2">"Paranormal Distribution"</span><span class="p">)</span> <span class="o">+</span> <span class="n">theme_old</span></code></pre></figure>

<h4 id="put-them-together">Put them together</h4>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">grid.arrange</span><span class="p">(</span><span class="n">gplot1</span><span class="p">,</span> <span class="n">gplot2</span><span class="p">)</span></code></pre></figure>
 ]]></content>
  </entry>
  
  <entry>
    <title>A Talk About Campaign Finance in Brazil</title>
    <link rel="alternate" type="text/html" href="/blog/2015/talk-about-campaign-finance.html/?utm_source=RSS&amp;utm_medium=RSS&amp;utm_campaign=ATalkAboutCampaignFinanceinBrazil" />
    <published>2015-10-17T00:00:00Z</published>
    <updated>2015-10-17T00:00:00-03:00</updated>
    <id>/blog/2015/talk-about-campaign-finance</id>
    <content type="html"><![CDATA[ <p>Comments on campaign finance in brazil.</p>

<!--more-->

<p>Last week, I delivered a talk at <a href="http://www.unb.br">University of Brasilia</a> about my past research on the topic of campaign finance. I didn’t know in advance about the existence of this seminar. Indeed, it was a big surprise receiving the invitation from Prof. Marcelo Pimentel, who is teaching on Fridays afternoon a class on this topic with more than 50 registered students. I became his fan after seeing his syllabus. He did managed to assemble a handful studies covering why, what, how, and when money affects politics and elections in Brazil.</p>

<p>Though I covered a lot of factors in my talk, I think, I had the wrong pictures to show for a heterogeneous crowd. Instead of wasting time showing regression tables, and trying to solve understanding issues after showing them, I should have shown simple yet powerful pictures like the following ones, so to give the intuition about the relationship between money and votes, generally debated in the literature and media.</p>

<p><img src="http://danielmarcelino.github.io/img/2015/linearSS.png" alt="Linear Relationship with SS" /></p>

<p><img src="http://danielmarcelino.github.io/img/2015/u-shape.png" alt="U-Shape Relationship" /></p>

<p>Of course, the biggest challenge of this scholarship is how to disentangle any existing confounders in this rather seemingly relationship: votes ~ money.</p>

<p>Overall, we know the recipe, preparing the dishy is different  thing. Studies being conducted on this area try to find the “treatment effect” of money on votes: What would have happened if the candidate had spent only a fraction of his budget, or What would have happened if the candidate who spent only a fraction could spend more?</p>

<p>The problem arises because we can see one condition, but never both at the same time. The suboptimal solution is to measure the average effect <code class="highlighter-rouge">(Y_1i - Y_0i)</code>, or the average of groups of candidates, such as incumbents vs non-incumbents. It turns out that comparisons of who spend more or less in elections are likely to be a poor measure of the causal effect of campaign spending simply because selection bias should be extremely high (Morton and Williams, 2010). It’s not trivial to argue that those who has more money to spend would have earned more votes anyway.</p>

<p>As Angrist and Pischke point out in their 2009’s book, if selection bias is positive, the naïve comparison <code class="highlighter-rouge">E(Y_1i | c_i=1) - E(Y_0i | c_i=0)</code> can be a real problem, since the benefits of spending extra money is exaggerated.</p>

<p><img src="http://danielmarcelino.github.io/img/2015/Angrist_Pischke_bias.png" alt="U-Shape Relationship" /></p>

<p>It could be “easier” to provide causal inference on this if we run a randomized experiment. If the treatment of campaign spending levels is randomly assigned, selection bias would be zero. The experiment don’t need to be that large, if treated units are random selection from the population of candidates, then the impact on treated also applies to the population. Isn’t cool?</p>

 ]]></content>
  </entry>
  

</feed>