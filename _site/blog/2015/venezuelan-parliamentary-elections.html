<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Venezuelan Parliamentary Election: What do the Polls Say? &#8211; Data * Analysis + R</title>
<meta name="description" content="This entry explores the coming legislative election in Venezuela: Government is about to lose the majority.">
<meta name="keywords" content="R, rstats, polls">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Venezuelan Parliamentary Election: What do the Polls Say?">
<meta name="twitter:description" content="This entry explores the coming legislative election in Venezuela: Government is about to lose the majority.">
<meta name="twitter:site" content="@dmarcelinobr">
<meta name="twitter:creator" content="@dmarcelinobr">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://danielmarcelino.github.io/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Venezuelan Parliamentary Election: What do the Polls Say?">
<meta property="og:description" content="This entry explores the coming legislative election in Venezuela: Government is about to lose the majority.">
<meta property="og:url" content="http://danielmarcelino.github.io/blog/2015/venezuelan-parliamentary-elections.html">
<meta property="og:site_name" content="Data * Analysis + R">





<link rel="canonical" href="http://danielmarcelino.github.io/blog/2015/venezuelan-parliamentary-elections.html">
<link href="http://danielmarcelino.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Data * Analysis + R Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://danielmarcelino.github.io/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://danielmarcelino.github.io/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://danielmarcelino.github.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://danielmarcelino.github.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://danielmarcelino.github.io/favicon.ico?r=31241">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://danielmarcelino.github.io/favicon.png?r=31241">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://danielmarcelino.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://danielmarcelino.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://danielmarcelino.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://danielmarcelino.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="http://danielmarcelino.github.io/blog/" >Blog</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/interests/" >Interests</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/about/" >About</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/randomwalks/" >Random Walks</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/resources/" >Resources</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="http://danielmarcelino.github.io/">Data * Analysis + R</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Blog of Daniel Marcelino</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://danielmarcelino.github.io/tags/#R" title="Pages tagged R">R</a>&nbsp;&bull;&nbsp;<a href="http://danielmarcelino.github.io/tags/#rstats" title="Pages tagged rstats">rstats</a>&nbsp;&bull;&nbsp;<a href="http://danielmarcelino.github.io/tags/#polls" title="Pages tagged polls">polls</a></span>
        
          <h1 class="entry-title">Venezuelan Parliamentary Election: What do the Polls Say?</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="http://danielmarcelino.github.io/img/DSC02844.jpg" class="bio-photo" alt="Daniel Marcelino bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Daniel Marcelino</span></span>
        <span class="entry-date date published"><time datetime="2015-12-06T00:00:00-02:00"><i class="fa fa-calendar-o"></i> December 06, 2015</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=R,rstats,polls&amp;text=Venezuelan%20Parliamentary%20Election:%20What%20do%20the%20Polls%20Say?&amp;url=http://danielmarcelino.github.io/blog/2015/venezuelan-parliamentary-elections.html&amp;via=dmarcelinobr" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://danielmarcelino.github.io/blog/2015/venezuelan-parliamentary-elections.html" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=http://danielmarcelino.github.io/blog/2015/venezuelan-parliamentary-elections.html" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
      </footer>
      <div class="entry-content">
        <p>There is not a huge population of opinion polls covering this parliamentary election in Venezuela, but all I’ve can be used to gauge the public opinion by the local polling houses. This posting begs an obvious question: how has the mood in Venezuela varied over time with respect to voting intentions for the two political blocs? Next, can we detect any biases among those publishing polls?</p>

<!--more-->

<h1 id="the-data">The data</h1>
<p>I’ve collected some polls available on the internet dating back to January 2014, which I made available <a href="https://github.com/danielmarcelino/Polling/raw/master/Venezuela/data/polls.txt">here</a> after some <a href="http://www.nytimes.com/2014/08/18/technology/for-big-data-scientists-hurdle-to-insights-is-janitor-work.html?_r=0">data janitor work</a>.</p>

<h1 id="polls-over-time">Polls over time</h1>
<p>After a bit filling-in-the-blanks working with missing date values, we can visualize the poll trends over time. Given the sample size, sampling error and other sources of noise, a loess model can pretty much pick out the signals of long-term trends.</p>

<p><img src="http://danielmarcelino.github.io/img/code-2015-12-06-venezuelan-parliamentary-elections/loess-1.png" alt="center" /></p>

<h1 id="pollster-biases">Pollster biases</h1>
<p>Let’s pretend we can trust on all those polls despite the huge variability among them as already mentioned <a href="https://danielmarcelino.github.io/r/2015/12/04/venezuelan-parliamentary-election-2015/">here</a>. In fact, the problem is not the variability as such, but my lack of knowledge about who are the pollsters and their past performance, so I can’t judge them at first, let’s say it clearly.
Nonetheless, if we accept the above models as a sound estimate of the expected poll response at a given time, we can analyze the residuals of actual poll results and look for systematic biases. In theory, with a decent sample size (all have ~ 1300) and a reasonably stratified sampling method (I’m not even assuming  random samples here), we might expect polls results to be roughly normally distributed around the expected polls result, regardless of who performed or commissioned the poll, right?</p>

<p>The graph below shows the distributions per polling house for those who polled more than a single poll in this dataset.</p>

<p><img src="http://danielmarcelino.github.io/img/code-2015-12-06-venezuelan-parliamentary-elections/biases-3.png" alt="center" /></p>

<p>We’ve to keep in mind that there are important caveats which we’re not addressing here, as that different polls have used different question sets, methods etc, so this isn’t evidence for anything underhanded per se. It seems reasonable to expect that while parties might have good reasons to publish polls in their favor, pollsters conducting the polls should generally be more or less indifferent.</p>

<p>The results are hampered by a small number of data points per pollster, and that to claim they are polling significantly above or below expectation, save for the <em>Hercón</em>, which is significantly more pro opposition (MUD) than expected, given the probability laws, although the p-value is just above the 5% thumb/convention. With a little research, I figure out that <em>Datanálisis</em> performed fine in the previous elections, and here it appears just around the center of the distribution leaning toward the Socialists (PSUV).</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left"><strong>pollster</strong></th>
      <th style="text-align: right"><strong>p</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Meganalisis</td>
      <td style="text-align: right">0.1875000</td>
    </tr>
    <tr>
      <td style="text-align: left">Venebarómetro</td>
      <td style="text-align: right">0.2500000</td>
    </tr>
    <tr>
      <td style="text-align: left">IVAD</td>
      <td style="text-align: right">0.4375000</td>
    </tr>
    <tr>
      <td style="text-align: left">ICS</td>
      <td style="text-align: right">0.5000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Delphos</td>
      <td style="text-align: right">1.0000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Datanálisis</td>
      <td style="text-align: right">0.7646484</td>
    </tr>
    <tr>
      <td style="text-align: left">VARIANZAS</td>
      <td style="text-align: right">1.0000000</td>
    </tr>
    <tr>
      <td style="text-align: left">Consultores</td>
      <td style="text-align: right">0.2500000</td>
    </tr>
    <tr>
      <td style="text-align: left">DatinCorp</td>
      <td style="text-align: right">0.5625000</td>
    </tr>
    <tr>
      <td style="text-align: left">Keller y Asociados</td>
      <td style="text-align: right">0.2500000</td>
    </tr>
    <tr>
      <td style="text-align: left">Hercón</td>
      <td style="text-align: right">0.0625000</td>
    </tr>
  </tbody>
</table>

<h1 id="conclusion">Conclusion</h1>

<p>What do the polls say? Well, the majority of Venezuelans are favoring opposition candidates and this has been the trend for at least the latter two years, however polls appear to have been more variable in recent months. This election is expected to bring the opposition to control the National Assembly after 16 years loosing the elections in the country. 
The Venezuela’s Socialists seem to be at risk, but predicting the final number of seats is a tough task that I’m not considering in this post. 
In fact, it might be really difficult to set forth a range of winning seats as the government recently enacted some redistricting seats in order to weaken an eventual absolute majority by the opposition. Somehow, the polls show this will be a significant symbolic defeat for the government that shows it lost despite all the advantages in state power and control over the media.</p>

<h2 id="update-error">UPDATE (Error)</h2>
<p>I was informed by André Salvati that the code block below was producing an error message of unknown column; the missing part has been included. Thanks for letting me know. The whole code can be found in this <a href="https://gist.github.com/danielmarcelino/904c804b2681ac8a9d08">gist</a></p>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">library</span><span class="p">(</span><span class="s2">"dplyr"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"ggplot2"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"grid"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"reshape2"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"lubridate"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"scales"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"knitr"</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="s2">"SciencesPo"</span><span class="p">)</span><span class="w"> </span><span class="c1"># to use the themes, you must install the version from github
</span><span class="w">
</span><span class="n">source</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"https://github.com/danielmarcelino/Polling/raw/master/Venezuela/data/polls.txt"</span><span class="w">

</span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.csv</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="w"> </span><span class="n">sep</span><span class="o">=</span><span class="s2">"\t"</span><span class="p">,</span><span class="w"> </span><span class="n">encoding</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"UTF-8"</span><span class="p">)</span><span class="w">

</span><span class="c1"># Correcting for empty date values
</span><span class="n">head</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">lapply</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">2</span><span class="o">:</span><span class="m">3</span><span class="p">],</span><span class="n">as.Date</span><span class="p">,</span><span class="w"> </span><span class="n">format</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"%d-%m-%Y"</span><span class="p">)</span><span class="w">

</span><span class="n">times</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)(</span><span class="n">x</span><span class="o">*</span><span class="m">100</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="p">[,</span><span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">]</span><span class="o">&lt;-</span><span class="n">lapply</span><span class="p">(</span><span class="n">data</span><span class="p">[,</span><span class="m">5</span><span class="o">:</span><span class="m">8</span><span class="p">],</span><span class="n">times</span><span class="p">)</span><span class="w">

</span><span class="n">days</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="o">-</span><span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="n">mask</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">is.na</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="p">)</span><span class="w">

</span><span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">+</span><span class="n">days</span><span class="w">

</span><span class="c1"># Find middle time point
</span><span class="n">DaysInField</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">round</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="o">$</span><span class="n">end</span><span class="o">-</span><span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="w">
</span><span class="n">data</span><span class="o">$</span><span class="n">date</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="o">$</span><span class="n">begin</span><span class="o">+</span><span class="n">DaysInField</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="n">polls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">melt</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">id.vars</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"house"</span><span class="p">,</span><span class="w"> </span><span class="s2">"date"</span><span class="p">),</span><span class="w"> 
     </span><span class="n">measure.var</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"MUD"</span><span class="p">,</span><span class="w"> </span><span class="s2">"PSUV"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Others"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Undecided"</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">polls</span><span class="p">)[</span><span class="m">3</span><span class="p">]</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">"response"</span><span class="w">
</span><span class="n">levels</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">response</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"MUD"</span><span class="p">,</span><span class="w"> </span><span class="s2">"PSUV"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Others"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Swing"</span><span class="p">)</span><span class="w">


</span><span class="n">ggplot</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">date</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">response</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">response</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_point</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">"loess"</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="o">=</span><span class="n">I</span><span class="p">(</span><span class="m">.2</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">theme_538</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> 
 </span><span class="n">theme</span><span class="p">(</span><span class="n">legend.position</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">.5</span><span class="p">,</span><span class="m">.95</span><span class="p">),</span><span class="w"> </span><span class="n">legend.direction</span><span class="o">=</span><span class="s2">"horizontal"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orange"</span><span class="p">,</span><span class="w"> </span><span class="s2">"grey40"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_fill_manual</span><span class="p">(</span><span class="n">values</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">,</span><span class="w"> </span><span class="s2">"orange"</span><span class="p">,</span><span class="w"> </span><span class="s2">"grey40"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_x_date</span><span class="p">(</span><span class="n">labels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">date_format</span><span class="p">(</span><span class="s2">"%b '%y"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">scale_y_continuous</span><span class="p">(</span><span class="n">breaks</span><span class="o">=</span><span class="n">seq</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">70</span><span class="p">,</span><span class="w"> </span><span class="m">10</span><span class="p">),</span><span class="w"> </span><span class="n">limits</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">70</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="m">1.2</span><span class="p">,</span><span class="n">colour</span><span class="o">=</span><span class="s2">"#535353"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Vote Intention Among Venezuelans"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="s2">"%"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="s2">"Poll response:"</span><span class="p">,</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="s2">"Poll response:"</span><span class="p">)</span><span class="w">
</span><span class="c1"># credits
</span><span class="w"> </span><span class="n">geom_foot</span><span class="p">(</span><span class="s2">"danielmarcelino.github.io"</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## Residual analysis per pollster
</span><span class="n">l.MUD</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">loess</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="o">==</span><span class="s2">"MUD"</span><span class="p">))</span><span class="w">
</span><span class="n">l.PSUV</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">loess</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="o">==</span><span class="s2">"PSUV"</span><span class="p">))</span><span class="w">
</span><span class="n">l.Others</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">loess</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="o">==</span><span class="s2">"Others"</span><span class="p">))</span><span class="w">
</span><span class="n">l.Swing</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">loess</span><span class="p">(</span><span class="n">value</span><span class="w"> </span><span class="o">~</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w"> </span><span class="n">data</span><span class="o">=</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="o">==</span><span class="s2">"Swing"</span><span class="p">))</span><span class="w">

</span><span class="n">with</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">plot</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">),</span><span class="w"> </span><span class="n">value</span><span class="p">))</span><span class="w">
</span><span class="n">lines</span><span class="p">(</span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">polls</span><span class="p">[</span><span class="n">polls</span><span class="o">$</span><span class="n">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"MUD"</span><span class="p">,]</span><span class="o">$</span><span class="n">date</span><span class="p">),</span><span class="w">
      </span><span class="n">predict</span><span class="p">(</span><span class="n">l.MUD</span><span class="p">,</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">polls</span><span class="p">[</span><span class="n">polls</span><span class="o">$</span><span class="n">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"MUD"</span><span class="p">,]</span><span class="o">$</span><span class="n">date</span><span class="p">)))</span><span class="w">

</span><span class="c1"># Calculate predicted values per row, 
</span><span class="n">polls</span><span class="o">$</span><span class="n">predicted</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="kc">NA</span><span class="w">

</span><span class="n">loessPrediction</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="w"> </span><span class="n">model</span><span class="p">){</span><span class="w">
  </span><span class="n">rows</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polls</span><span class="o">$</span><span class="n">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">resp</span><span class="w">
  </span><span class="n">curr</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polls</span><span class="p">[</span><span class="n">rows</span><span class="p">,]</span><span class="w">
  </span><span class="n">preds</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">with</span><span class="p">(</span><span class="n">curr</span><span class="p">,</span><span class="w"> </span><span class="n">predict</span><span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="nf">as.numeric</span><span class="p">(</span><span class="n">date</span><span class="p">)))</span><span class="w">
  </span><span class="n">polls</span><span class="p">[</span><span class="n">rows</span><span class="p">,]</span><span class="o">$</span><span class="n">predicted</span><span class="w"> </span><span class="o">&lt;&lt;-</span><span class="w"> </span><span class="n">preds</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"MUD"</span><span class="p">,</span><span class="w"> </span><span class="n">l.MUD</span><span class="p">)</span><span class="w">
</span><span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"PSUV"</span><span class="p">,</span><span class="w"> </span><span class="n">l.PSUV</span><span class="p">)</span><span class="w">
</span><span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"Others"</span><span class="p">,</span><span class="w"> </span><span class="n">l.Others</span><span class="p">)</span><span class="w">
</span><span class="n">loessPrediction</span><span class="p">(</span><span class="s2">"Swing"</span><span class="p">,</span><span class="w"> </span><span class="n">l.Swing</span><span class="p">)</span><span class="w">

</span><span class="n">polls</span><span class="o">$</span><span class="n">residual</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polls</span><span class="o">$</span><span class="n">value</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">polls</span><span class="o">$</span><span class="n">predicted</span><span class="w">
</span><span class="n">hist</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">residual</span><span class="p">)</span><span class="w">

</span><span class="c1">## Check pollsters' names
</span><span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">" ?\\(.*"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w"> </span><span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="p">)</span><span class="w">
</span><span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">gsub</span><span class="p">(</span><span class="s2">"-"</span><span class="p">,</span><span class="w"> </span><span class="s2">" "</span><span class="p">,</span><span class="w"> </span><span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="p">)</span><span class="w">

</span><span class="n">houseNames</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">do.call</span><span class="p">(</span><span class="n">rbind</span><span class="p">,</span><span class="w"> </span><span class="n">strsplit</span><span class="p">(</span><span class="nf">as.character</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">house</span><span class="p">),</span><span class="w"> </span><span class="s2">"/"</span><span class="p">))</span><span class="w">
</span><span class="n">colnames</span><span class="p">(</span><span class="n">houseNames</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"pollster"</span><span class="p">,</span><span class="w"> </span><span class="s2">"commission"</span><span class="p">)</span><span class="w">

</span><span class="n">polls</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">cbind</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">houseNames</span><span class="p">)</span><span class="w">

</span><span class="c1">## Order pollster by median residual:
</span><span class="n">ordering</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">group_by</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">pollster</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">filter</span><span class="p">(</span><span class="n">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"MUD"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarize</span><span class="p">(</span><span class="n">med</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span><span class="w"> </span><span class="n">na.rm</span><span class="o">=</span><span class="nb">T</span><span class="p">),</span><span class="w"> </span><span class="n">count</span><span class="o">=</span><span class="n">n</span><span class="p">())</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">arrange</span><span class="p">(</span><span class="n">med</span><span class="p">)</span><span class="w"> 

</span><span class="n">polls</span><span class="o">$</span><span class="n">pollster</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">polls</span><span class="o">$</span><span class="n">pollster</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="n">ordering</span><span class="o">$</span><span class="n">pollster</span><span class="p">)</span><span class="w">

</span><span class="c1">## Testing for biases by a given pollster 
</span><span class="n">ggplot</span><span class="p">(</span><span class="n">subset</span><span class="p">(</span><span class="n">polls</span><span class="p">,</span><span class="w"> </span><span class="n">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"MUD"</span><span class="p">),</span><span class="w"> 
       </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">pollster</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">residual</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_hline</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">yintercept</span><span class="o">=</span><span class="m">0</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">geom_violin</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="s2">"width"</span><span class="p">,</span><span class="w"> </span><span class="n">fill</span><span class="o">=</span><span class="n">I</span><span class="p">(</span><span class="s2">"grey50"</span><span class="p">),</span><span class="w"> </span><span class="n">col</span><span class="o">=</span><span class="n">I</span><span class="p">(</span><span class="s2">"grey50"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">geom_jitter</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="n">position_jitter</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="m">.05</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w"> 
  </span><span class="n">stat_summary</span><span class="p">(</span><span class="n">geom</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"crossbar"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">0.75</span><span class="p">,</span><span class="w"> </span><span class="n">fatten</span><span class="o">=</span><span class="m">2</span><span class="p">,</span><span class="w"> 
               </span><span class="n">color</span><span class="o">=</span><span class="s2">"grey20"</span><span class="p">,</span><span class="w"> </span><span class="n">fun.y</span><span class="o">=</span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">fun.ymin</span><span class="o">=</span><span class="n">median</span><span class="p">,</span><span class="w"> </span><span class="n">fun.ymax</span><span class="o">=</span><span class="n">median</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">coord_flip</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">theme_538</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">ggtitle</span><span class="p">(</span><span class="s2">"Relative MUD voting intentions"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">"Polling house"</span><span class="p">,</span><span class="w">
       </span><span class="n">y</span><span class="o">=</span><span class="s2">"Comparison with other polls at the time"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
  </span><span class="n">ylim</span><span class="p">(</span><span class="m">-12</span><span class="p">,</span><span class="m">12</span><span class="p">)</span></code></pre></figure>

<figure class="highlight"><pre><code class="language-r" data-lang="r"><span class="c1">## Stats significance, is it any?
</span><span class="n">options</span><span class="p">(</span><span class="n">scipen</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="w">
</span><span class="n">sigTable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">polls</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">response</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"MUD"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">group_by</span><span class="p">(</span><span class="w"> </span><span class="n">pollster</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
  </span><span class="n">summarise</span><span class="p">(</span><span class="n">p</span><span class="o">=</span><span class="n">wilcox.test</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span><span class="w"> </span><span class="n">mu</span><span class="o">=</span><span class="m">0</span><span class="p">)</span><span class="o">$</span><span class="n">p.value</span><span class="p">)</span><span class="w"> 
</span><span class="n">kable</span><span class="p">(</span><span class="n">sigTable</span><span class="p">)</span></code></pre></figure>


        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'daniel-marcelino'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://danielmarcelino.github.io/blog/2015/venezuelan-parliamentary-election-2015.html" class="btn" title="Venezuela's 2015 Parliamentary Elections">Previous</a>
      
      
        <a href="http://danielmarcelino.github.io/blog/2015/gender-effect-in-conference-talks.html" class="btn" title="Gender Effect in Conference Talks">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2016 Daniel Marcelino</span>
<div class="social-icons">
	<a href="https://twitter.com/dmarcelinobr" title="Daniel Marcelino on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/daniel.marcelino.796" title="Daniel Marcelino on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	
	<a href="https://linkedin.com/in/daniel-marcelino-80968656" title="Daniel Marcelino on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="http://stackoverflow.com/users/792000/daniel" title="Daniel Marcelino on StackExchange" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
	<a href="https://instagram.com/dmarcelinobr" title="Daniel Marcelino on Instagram" target="_blank"><i class="fa fa-instagram fa-2x"></i></a>
	
	<a href="https://github.com/danielmarcelino" title="Daniel Marcelino on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="http://danielmarcelino.github.io/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://danielmarcelino.github.io';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://danielmarcelino.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://danielmarcelino.github.io/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-24186657-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24186657-1', 'auto');
  ga('send', 'pageview');

</script>


<!-- htmlwidgets dependencies --> 
<script src="/htmlwidgets_deps/htmlwidgets-0.5/htmlwidgets.js"></script>
<script src="/htmlwidgets_deps/d3-3.5.3/d3.min.js"></script>
<link href="/htmlwidgets_deps/colorbrewer-1/colorbrewer.css" rel="stylesheet" />
<script src="/htmlwidgets_deps/colorbrewer-1/colorbrewer.js"></script>
<link href="/htmlwidgets_deps/streamgraph-1/streamgraph.css" rel="stylesheet" />
<script src="/htmlwidgets_deps/streamgraph-binding-0.8.1/streamgraph.js"></script>


</body>
</html>
