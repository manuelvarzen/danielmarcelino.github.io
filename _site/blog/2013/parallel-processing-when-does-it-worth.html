<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Parallel Processing: When does it worth? &#8211; Data * Analysis + R</title>
<meta name="description" content="This post shows parallel computing is incredibly useful, but not every thing worths being distributed across as many cores as possible.">
<meta name="keywords" content="R, rstats, parallel">


<!-- Twitter Cards -->
<meta name="twitter:title" content="Parallel Processing: When does it worth?">
<meta name="twitter:description" content="This post shows parallel computing is incredibly useful, but not every thing worths being distributed across as many cores as possible.">
<meta name="twitter:site" content="@dmarcelinobr">
<meta name="twitter:creator" content="@dmarcelinobr">

<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://danielmarcelino.github.io/images/">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Parallel Processing: When does it worth?">
<meta property="og:description" content="This post shows parallel computing is incredibly useful, but not every thing worths being distributed across as many cores as possible.">
<meta property="og:url" content="http://danielmarcelino.github.io/blog/2013/parallel-processing-when-does-it-worth.html">
<meta property="og:site_name" content="Data * Analysis + R">





<link rel="canonical" href="http://danielmarcelino.github.io/blog/2013/parallel-processing-when-does-it-worth.html">
<link href="http://danielmarcelino.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Data * Analysis + R Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://danielmarcelino.github.io/assets/css/main.css">
<!-- Webfonts -->
<script src="https://use.edgefonts.net/source-sans-pro:n2,i2,n3,i3,n4,i4,n6,i6,n7,i7,n9,i9;source-code-pro:n4,n7;volkhov.js"></script>

<meta http-equiv="cleartype" content="on">

<!-- HTML5 Shiv and Media Query Support -->
<!--[if lt IE 9]>
  <script src="http://danielmarcelino.github.io/assets/js/vendor/html5shiv.min.js"></script>
  <script src="http://danielmarcelino.github.io/assets/js/vendor/respond.min.js"></script>
<![endif]-->

<!-- Modernizr -->
<script src="http://danielmarcelino.github.io/assets/js/vendor/modernizr-2.7.1.custom.min.js"></script>


<!-- MathJax -->
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://danielmarcelino.github.io/favicon.ico?r=31241">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://danielmarcelino.github.io/favicon.png?r=31241">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://danielmarcelino.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://danielmarcelino.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://danielmarcelino.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://danielmarcelino.github.io/images/apple-touch-icon-144x144-precomposed.png">

</head>

<body id="post">

<div class="navigation-wrapper">
	<nav role="navigation" id="site-nav" class="animated drop">
	    <ul>
      
		    
		    <li><a href="http://danielmarcelino.github.io/blog/" >Blog</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/interests/" >Interests</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/about/" >About</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/randomwalks/" >Random Walks</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/resources/" >Resources</a></li>
		  
		    
		    <li><a href="http://danielmarcelino.github.io/search/" >Search</a></li>
		  
	    </ul>
	</nav>
</div><!-- /.navigation-wrapper -->

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->

<header class="masthead">
	<div class="wrap">
      
      <h1 class="site-title animated fadeIn"><a href="http://danielmarcelino.github.io/">Data * Analysis + R</a></h1>
		<h2 class="site-description animated fadeIn" itemprop="description">Blog of Daniel Marcelino</h2>
	</div>
</header><!-- /.masthead -->

<div class="js-menu-screen menu-screen"></div>


<div id="main" role="main">
  <article class="hentry">
    
    <div class="entry-wrapper">
      <header class="entry-header">
        <span class="entry-tags"><a href="http://danielmarcelino.github.io/tags/#R" title="Pages tagged R">R</a>&nbsp;&bull;&nbsp;<a href="http://danielmarcelino.github.io/tags/#rstats" title="Pages tagged rstats">rstats</a>&nbsp;&bull;&nbsp;<a href="http://danielmarcelino.github.io/tags/#parallel" title="Pages tagged parallel">parallel</a></span>
        
          <h1 class="entry-title">Parallel Processing: When does it worth?</h1>
        
      </header>
      <footer class="entry-meta">
        
        
          <img src="http://danielmarcelino.github.io/img/DSC02844.jpg" class="bio-photo" alt="Daniel Marcelino bio photo"></a>
        
        <span class="author vcard">By <span class="fn">Daniel Marcelino</span></span>
        <span class="entry-date date published"><time datetime="2013-05-29T00:00:00-03:00"><i class="fa fa-calendar-o"></i> May 29, 2013</time></span>
        
        <span class="entry-comments"><i class="fa fa-comment-o"></i> <a href="#disqus_thread">Comment</a></span>
        <span class="social-share-twitter">
  <a href="https://twitter.com/intent/tweet?hashtags=R,rstats,parallel&amp;text=Parallel%20Processing:%20When%20does%20it%20worth?&amp;url=http://danielmarcelino.github.io/blog/2013/parallel-processing-when-does-it-worth.html&amp;via=dmarcelinobr" title="Share on Twitter" itemprop="Twitter"><i class="fa fa-twitter-square"></i> Tweet</a>
</span>
<span class="social-share-facebook">
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://danielmarcelino.github.io/blog/2013/parallel-processing-when-does-it-worth.html" title="Share on Facebook" itemprop="Facebook"><i class="fa fa-facebook-square"></i> Like</a>
</span>
<span class="social-share-googleplus">
  <a href="https://plus.google.com/share?url=http://danielmarcelino.github.io/blog/2013/parallel-processing-when-does-it-worth.html" title="Share on Google Plus" itemprop="GooglePlus"><i class="fa fa-google-plus-square"></i> +1</a>
</span>
<!-- /.social-share -->
        
      </footer>
      <div class="entry-content">
        <p>This post shows parallel computing is incredibly useful, but not every thing worths being distributed across as many cores as possible.</p>

<p>Most computers nowadays have few cores that incredibly help us with our daily computing duties. However, when statistical softwares do use parallelization for analyzing data faster? R, my preferred analytical software, does not take too much advantage of multicore processing by default.</p>

<p>In fact, R has been inherently a “single-processor” package until nowadays. Stata, another decent statistical package, allows for multicore processing, but not yet implemented for the default version. Additionally, Stata versions for multicore are quite expensive, for instance, if I want to use all of my quad-core computer power, I have to pay out $1,095 for a 4-core single license.</p>

<p>Fortunately, several packages exploiting the resources of parallel processing began to gain attention in the R community lately. Specially, because of many computationally demanding statistical procedures, such as bootstrapping and Markov Chain Monte Carlo, I guess. Nonetheless, the myth of fast computation has also leading for (miss)understanding by ordinary R users like me. Yet before distributing patches among CPUs, it is important to have it clear when and why parallel processing is helpful and which functions performs better for a given job.</p>

<p>First, what does exactly parallel do? Despite its complex implementation, the idea is incredible simple: parallelization simply distribute the work among two or more cores. It is done by packages that provide backend for the “foreach” function to work. The foreach function allows R to distribute the processes, each of which having access to the same shared memory; so the computer not get confused. For instance, in the program bellow, several instances of lapply-like function are able to access the processing units and then deal out with all the work.</p>

<p>Since not every task runs better in parallel there is not too many ready to use parallel processing functions in R. Additionally, distributing processes among the cores may cause computation overhead. That means we may lose computer time and memory, firstly by distributing, secondly by gathering the patches shared out among the processing units. Therefore, depending on the task (time and memory demand), parallel computing can be rather inefficient. It may take more time for dispatching the processes and gathering them back than the computation itself. Hence, counterintuitively, one might want to minimize the number of dispatches rather than distribute them.</p>

<p><img src="http://danielmarcelino.github.io/img/2013/parallel.jpg" alt="Experiment Result" /></p>

<p>Here, I’m testing a nontrivial computation instance for measuring computer performance on four relevant functions: the base <strong>lapply</strong>, <strong>mclapply</strong> from the “multicore“ package, <strong>parLapply</strong> from “snow” package, and <strong>sfLapply</strong> from “snowfall“ package. The last three functions essentially provide parallelized equivalent for the <code class="highlighter-rouge">lapply</code>. I use these packages for parallel computing the average for each column of a data frame built on the fly, but repeating this procedure 100 times for each data frame trial; so each trial demands different amount of time and memory for computing: the matrix size increases as 1K, 10K, 100K, 1M, and 10M rows. The program I used for simulate the data and perform all the tests can be found <a href="https://gist.github.com/danielmarcelino/5668701">here</a>. I used Emacs on a MacBook pro with 4-core and 8-G memory.</p>

<p><img src="http://danielmarcelino.github.io/img/2013/parallelfinal.jpeg" alt="Final Results" /></p>

<p>My initial experiment also included the “mpi.parLapply” function from the “Rmpi” package. However, because it is outdated for running on R version 3.0, I decided for not including it in this instance.</p>

<p>Overall, running repetition tasks in parallel incurs overhead. Therefore, only if the process takes a significant amount of time and memory (RAM), parallelization can improve the overall performance.</p>

<p>The plots above, provide evidence when an individual process takes less than a second (<code class="highlighter-rouge">2.650/100 = 26.5 milliseconds </code> comparable to <code class="highlighter-rouge">13.419/100 = 134.2 milliseconds</code>) to be executed, the overhead of continually patching processes will decay the overall performance. For instance, in the first chart, the lapply function took less than one-third of the time of <strong>sfLapply</strong> to perform the same job. However, the pattern changes dramatically when the computer needs to repeat the same task with large vectors (&gt;= 1 million rows).</p>

<p>In fact, I noticed that all functions began to consume even more time computing  averages of big matrixes than I expected. But in a setting with 10 millions rows, the <strong>lapply</strong> function was dramatically inefficient: it took <code class="highlighter-rouge">1281.8/100 = 12.82 seconds</code> for each process, while the <strong>mclapply</strong> only took <code class="highlighter-rouge">525.4/100 = 5.254 seconds</code>.</p>


        
          <div id="disqus_thread"></div><!-- /#disqus_thread -->
          
<script type="text/javascript">
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'daniel-marcelino'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'https://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

        
      </div><!-- /.entry-content -->
    </div><!-- /.entry-wrapper -->
    <nav class="pagination" role="navigation">
      
        <a href="http://danielmarcelino.github.io/blog/2011/explaining-variance-in-a-multilevel-model.html" class="btn" title="Showing Explained Variance in Multilevel Models">Previous</a>
      
      
        <a href="http://danielmarcelino.github.io/blog/2013/got-bootstrap.html" class="btn" title="Got Bootstrap?">Next</a>
      
    </nav><!-- /.pagination -->
  </article>
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo" class="entry-wrapper">
    

<span>&copy; 2016 Daniel Marcelino</span>
<div class="social-icons">
	<a href="https://twitter.com/dmarcelinobr" title="Daniel Marcelino on Twitter" target="_blank"><i class="fa fa-twitter-square fa-2x"></i></a>
	<a href="https://facebook.com/daniel.marcelino.796" title="Daniel Marcelino on Facebook" target="_blank"><i class="fa fa-facebook-square fa-2x"></i></a>
	
	<a href="https://linkedin.com/in/daniel-marcelino-80968656" title="Daniel Marcelino on LinkedIn" target="_blank"><i class="fa fa-linkedin-square fa-2x"></i></a>
	<a href="http://stackoverflow.com/users/792000/daniel" title="Daniel Marcelino on StackExchange" target="_blank"><i class="fa fa-stack-exchange fa-2x"></i></a>
	<a href="https://instagram.com/dmarcelinobr" title="Daniel Marcelino on Instagram" target="_blank"><i class="fa fa-instagram fa-2x"></i></a>
	
	<a href="https://github.com/danielmarcelino" title="Daniel Marcelino on Github" target="_blank"><i class="fa fa-github-square fa-2x"></i></a>
	
  
	
  <a href="http://danielmarcelino.github.io/feed.xml" title="Atom/RSS feed"><i class="fa fa-rss-square fa-2x"></i></a>
</div><!-- /.social-icons -->

  </footer>
</div><!-- /.footer-wrapper -->

<script type="text/javascript">
  var BASE_URL = 'http://danielmarcelino.github.io';
</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://danielmarcelino.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://danielmarcelino.github.io/assets/js/scripts.min.js"></script>


<!-- Asynchronous Google Analytics snippet -->
<script>
  var _gaq = _gaq || [];
  var pluginUrl =
 'https://www.google-analytics.com/plugins/ga/inpage_linkid.js';
  _gaq.push(['_require', 'inpage_linkid', pluginUrl]);
  _gaq.push(['_setAccount', 'UA-24186657-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = 'https://stats.g.doubleclick.net/dc.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>


<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-24186657-1', 'auto');
  ga('send', 'pageview');

</script>


<!-- htmlwidgets dependencies --> 
<script src="/htmlwidgets_deps/htmlwidgets-0.5/htmlwidgets.js"></script>
<script src="/htmlwidgets_deps/d3-3.5.3/d3.min.js"></script>
<link href="/htmlwidgets_deps/colorbrewer-1/colorbrewer.css" rel="stylesheet" />
<script src="/htmlwidgets_deps/colorbrewer-1/colorbrewer.js"></script>
<link href="/htmlwidgets_deps/streamgraph-1/streamgraph.css" rel="stylesheet" />
<script src="/htmlwidgets_deps/streamgraph-binding-0.8.1/streamgraph.js"></script>


</body>
</html>
