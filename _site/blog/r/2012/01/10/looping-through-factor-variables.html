<!DOCTYPE html>
<html lang="en">
	<head>
        <title>Looping through factor variables | Daniel Marcelino</title>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
        <meta name="keywords" content="methods, data analysis, R programming" />
        <meta name="author" content="Daniel Marcelino" />
        <meta name="description" content="Website of Daniel Marcelino" />
        <meta name="viewport" content="width=640px, initial-scale=1.0, maximum-scale=1.0">	
        <!-- favicon -->
        <link rel="shortcut icon" href="/images/favicon.ico">
        <!-- Google Fonts -->
		<link href="http://fonts.googleapis.com/css?family=Open+Sans:300italic,300,400,600" rel="stylesheet" type="text/css">
		<link href='http://fonts.googleapis.com/css?family=Vollkorn' rel='stylesheet' type='text/css'>
        <!-- Custom CSS -->
        <link rel="stylesheet" href="/css/main.css" type="text/css" media="screen, projection" />
		<link rel="alternate" type="application/rss+xml" title="EnfoRced Data Analysis" href="/feed.xml">
	<link rel="alternate" type="application/rss+xml" title="EnfoRced Data Analysis" href="/feed.r.xml">
		<link rel="alternate" type="application/atom+xml" title="EnfoRced Data Analysis" href="/atom.xml" />
		
	
</head>

	<body>


		<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

<div class="header-page">

<h1><a href="/"><span style='font-weight: bold;'>Daniel Marcelino</span></a></h1></span>
<div id="nav">
	<ul>
	   <li><a href="/blog" class="current"><strong>Blog</strong></a></li>
		<li><a href="/about" class=""><strong>About</strong></a></li>
	<li><a href="/research" class=""><strong>Research</strong></a></li>
		<li><a href="/teaching" class=""><strong>Teaching</strong></a></li>
		<li><a href="/software" class=""><strong>Software</strong></a></li>		
	<li><a href="/randomwalks" class=""><strong>Random Walks</strong></a></li>		
	</ul>
</div>

</div>


<div class="clear"></div>

<div id="block">
	<div class="prose"> 
	<div class="post">
	<h1> Looping through factor variables </h1>
	<!-- <span class="date">Posted on 10 Jan 2012</span> -->
	<h5>Posted on January 10, 2012</h5>
	
	<p>Today, I was chatting to a friend who is working on his Ph.D thesis which coincidently is about my favorite topic: campaign contributions. </p>

<!--more-->

<p><img src="/images/blog/2012/looping.png" alt="Looping" /></p>

<p>We discussed about analyzing probabilities of a particular group to grasp more money than the others, particularly, between male and female candidates given the district. 
I thought that a preliminary approach might consider identifying  whether a candidate received less or more money than the district average. In doing so, should be valuable to coding those case as “0 or 1” accordingly, so you can perform a logistic regression to  test for gender effects. 
This task can be performed pretty easy in all statistical packages, Excel included. </p>

<p>In Stata, for instance, it is enough to type: </p>

<div class="highlight"><pre><code class="language-text" data-lang="text">even stat emu = mean(revenue), by(state gender)</code></pre></div>

<p>while in R:</p>

<div class="highlight"><pre><code class="language-r" data-lang="r">mean <span class="o">&lt;-</span> <span class="kp">with</span><span class="p">(</span>data<span class="p">,</span> aggregate<span class="p">(</span>revenue<span class="p">,</span> by<span class="o">=</span><span class="kt">list</span><span class="p">(</span>state<span class="o">=</span>state<span class="p">,</span> gender<span class="o">=</span>gender<span class="p">),</span> FUN<span class="o">=</span><span class="kp">mean</span><span class="p">,</span> na.rm<span class="o">=</span><span class="kc">TRUE</span><span class="p">))</span><span class="m">.</span></code></pre></div>

<p>Problem solved clean and fast.</p>

<p>Despite I’m not a “gaúcho” I’d say: if we can complicate, why simplify? Joke aside, in general I favor to use the most simple solution ever. Thus, why bother with loops across observations and variables? What’s more, create loops, special the nested ones in large-N (i.e. large number of cases) data set, might be a suboptimal choice since loops decrease the computing efficiency. But, suppose that we’re faced to a data bank with wide number of factor variables, which have many categories: ordered or not. So, perhaps a nested loop across those factors could help us much better. That said, let’s go back to the case of my friend to try a different approach to visualize the average differences using a loop.</p>

<p>Below, I scratch a loop to find the average of contributions revenues to female and male for each state. Despite the following example is quite simple as I’m only looping through 2 factor variables, we can add as many factors we want to compute. Also, the outcome values doesn’t necessary should be average, but you can chose among standard error, percentiles et cetera.</p>

<p>After running the loop below, the averages for males and females will be displayed on your Stata screen as the picture shows.</p>

<div class="highlight"><pre><code class="language-text" data-lang="text">/* Drawing loop across the groups: electoral districts and gender */
/* Note that the command line levels of is necessary for store the levels contained
in the variable &quot;state&quot; and &quot;gender&quot; otherwise I need to provide them by hand */
quietly levels of state, local(states)
foreach s of local states {
quietly levels of gender if state == &quot;`s&#39;&quot;, local(genders)
foreach g of local genders {
quietly summarize revenue if gender ==&quot;`g&#39;&quot; &amp; state == &quot;`s&#39;&quot;, mean only
local mu = r(mean)
display &quot;Meam of Contributions for `g&#39; in `s&#39; = `mu&#39;&quot;
}
}</code></pre></div>

<p>For example, regardless my data set is pooled altogether candidates for a variety of offices, in Acre (AC) the first state shown in the picture above, the average of contributions for female is 45,983.57 while for male is around 51,116.96. For miner the outcome we might introduce other factors like office, incumbency, et cetera.</p>



</div>

<hr>
<p></p>

<div class="meta">
	
	
	<span class="categories">
		Published in categories
		
		<a href="/blog/categories/#r" title="r">r</a>&nbsp;
		
	</span>
	
	
	
	<span class="tags">
		Tagged with 
		
		<a href="/blog/tags/#R" title="R">R</a>&nbsp;
		
		<a href="/blog/tags/#looping" title="looping">looping</a>&nbsp;
		
	</span>
	
</div>


<div class="previous_next">
	
	  <a href="/blog/r/2011/10/04/drawing-maps-using-shapefiles-and-R.html" title="Previous post">&larr; previous</a>
	
	&nbsp;&nbsp;
	
	  <a href="/blog/r/2013/05/29/parallel-processing-when-does-it-worth.html" title="Next post">next &rarr;</a>
	
	<br>
	<p>
	<a class="greenbutton" href="/blog/archive/" title="an archive of all posts">See all posts &rarr;</a>
	</p>
</div>


<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'daniel-marcelino'; // required: replace example with your forum short name

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
	</div>
</div>


<div id="footer">

<div id="footer">
The contents of this blog is syndicated to <a href="http://www.r-bloggers.com">R-Bloggers</a> and <a href="http://www.statsblogs.com">Statsblogs</a> via <a href="http://danielmarcelino.com/atom.xml"> Atom/RSS feeds.</a> <br/><br/>
	&copy; <a href="/">Daniel Marcelino</a>. All contents under 
	<a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">(CC) BY-NC-SA license</a>, 
	unless otherwise noted.
	<br/><br/>
	Did you find this site useful? If yes, consider helping me with my  
	<a href="http://amzn.com/w/2CCCV54KPGIA2" target="_blank">wishlist</a>.
</div>


</div>




		<!-- Google Analytics -->
		<script>
  		  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  		  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  		  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  		  })(window, document,'script','//www.google-analytics.com/analytics.js','ga');

	  	  ga('create', 'UA-24186657-1', 'danielmarcelino.com');
  		  ga('send', 'pageview');

		</script>
		<!-- Google Analytics end -->

	</body>
</html>